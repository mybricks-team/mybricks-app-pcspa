"use strict";(self.webpackChunkmybricks=self.webpackChunkmybricks||[]).push([[551],{59551:(e,t,s)=>{s.r(t),s.d(t,{default:()=>o});var r=s(90359),n=s(22896),c=(s(78242),s(83446)),a=s(90359);function o({ctx:e}){const t=(0,r.useCallback)((t=>{const s=e.curScenes;if(s&&"Enter"===t.key){requestAnimationFrame((t=>{e.curRequest=""}));const r=t.target.value;if(!r||""===r)return void(e.curRequest="");const n={content:r,status:"loading"};e.response.push(n);const c=e.response[e.response.length-1],a=s.getPrompts(((e,t)=>e));e.request(r,a).then((e=>{c.status="done",c.result=e.replace(/\n/g,"<br/>")})).catch((e=>{c.status="error",e instanceof Error?c.result=e.message:c.result=e}))}}),[e.curScenes]),s=(0,c.vc)((()=>e.response.map(((e,t)=>{let s;return"loading"===e.status?s=a.createElement("span",{className:`${n.Z[e.status]}`},"(处理中)"):"apiDone"===e.status?s=a.createElement("span",{className:`${n.Z[e.status]}`},"设置OpenAI API Key完成"):"done"===e.status?s=a.createElement("span",{className:`${n.Z[e.status]}`,dangerouslySetInnerHTML:{__html:e.result}}):"error"===e.status&&(s=a.createElement("span",{className:`${n.Z[e.status]}`},"(",e.result,")")),a.createElement(r.Fragment,{key:t},a.createElement("div",{className:`${n.Z.request}`},"apiDone"!==e.status?e.content:""),s)})))),o=e.curScenes.placeholder||"请问您的问题是什么？";return a.createElement("div",{className:n.Z.view},a.createElement("div",{className:n.Z.curScene},a.createElement("span",null,"对于"),a.createElement("label",null,e.curScenes.title)),a.createElement("div",{className:n.Z.content,ref:e=>{e&&(e.scrollTop=e.scrollHeight)}},s),a.createElement("div",{className:`${n.Z.tb}`},e.getLLMIcon(),a.createElement("textarea",{placeholder:o,ref:e=>e&&e.focus(),onKeyDown:t,value:e.curRequest,onChange:t=>e.curRequest=t.target.value})))}},78242:(e,t,s)=>{s.d(t,{Z:()=>o});var r=s(81831);function n(e){const t={};for(let s=0;s<e.length;s++){const r=e[s];t[r]||(t[r]=0),t[r]++}return t}function c(e){let t=0;for(const s in e)t+=Math.pow(e[s],2);return Math.sqrt(t)}function a(e){return Array.from(new Intl.Segmenter("cn",{granularity:"word"}).segment(e)).filter((e=>e.isWordLike)).map((e=>e.segment))}const o=class{constructor(e){this.vectorLibs=[],this.vectorLibs=e.vectorLibs,this.ignores=e.ignore||[]}search(e,t=1){const s=this._getCosSims(e).slice(0,t);return(0,r.R)(this.vectorLibs,s.map((e=>e.index)))}getMaxSimilarity(e){const t=this._getCosSims(e)[0];return this.vectorLibs[t.index]}addVectors(e){this.vectorLibs=[...this.vectorLibs,...e]}updateVectors(e){this.vectorLibs=[...e]}_getCosSims(e){const t=[],s=a((0,r.z)(e));return this.vectorLibs.map(((e,o)=>{let i="";if("string"==typeof e)i=e;else if("object"==typeof e){const t={};for(let s in e)-1===this.ignores.indexOf(s)&&(t[s]=e[s]);i=JSON.stringify(t)}const u=function(e,t){const s=n(a((0,r.z)(e))),o=n(t);return function(e,t){let s=0;for(const r in e)t[r]&&(s+=e[r]*t[r]);return s}(s,o)/(c(s)*c(o))}(i,s);t.push({index:o,cosSim:u})})),t.sort(((e,t)=>t.cosSim-e.cosSim)),t}}},81831:(e,t,s)=>{function r(e,t){const s=[];return t.forEach((t=>{e[t]&&s.push(e[t])})),s}function n(e){return e.replace(/[!"#$%&'()*+,-./:;<=>?@[\\\]^_`{|}~！，。、；：？（）【】『』「」《》]/g,"")}s.d(t,{R:()=>r,z:()=>n})}}]);