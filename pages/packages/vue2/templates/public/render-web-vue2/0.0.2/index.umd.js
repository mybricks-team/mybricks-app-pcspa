(function(o,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(o=typeof globalThis<"u"?globalThis:o||self,e(o._mybricks_render_web_vue2={},o.Vue))})(this,function(exports,Vue){"use strict";var ke=Object.defineProperty;var Ae=(o,e,t)=>e in o?ke(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var Pe=(o,e,t)=>(Ae(o,typeof e!="symbol"?e+"":e,t),t);var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var comlibCore={exports:{}};(function(module,exports){(function(o,e){module.exports=e()})(commonjsGlobal,()=>(()=>{var __webpack_modules__={356:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function __WEBPACK_DEFAULT_EXPORT__({data,outputs,inputs,onError}){inputs.from((val,relOutpus)=>{var _a;const script=(_a=data.exchange)===null||_a===void 0?void 0:_a.script;if(script){let fn,returnVal,isOk;try{eval(`fn = ${script}`),returnVal=fn(val),isOk=!0}catch(o){console.error(o),onError(`数据转换错误:${o.message}`,o)}isOk&&outputs.to(returnVal)}else onError("未配置转换规则")})}__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__})}},__webpack_module_cache__={};function __webpack_require__(o){var e=__webpack_module_cache__[o];if(e!==void 0)return e.exports;var t=__webpack_module_cache__[o]={exports:{}};return __webpack_modules__[o](t,t.exports,__webpack_require__),t.exports}__webpack_require__.d=(o,e)=>{for(var t in e)__webpack_require__.o(e,t)&&!__webpack_require__.o(o,t)&&Object.defineProperty(o,t,{enumerable:!0,get:e[t]})},__webpack_require__.o=(o,e)=>Object.prototype.hasOwnProperty.call(o,e),__webpack_require__.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>b,getCom:()=>g});const o=JSON.parse('{"title":"Fn计算","namespace":"mybricks.core-comlib.fn","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"Fn计算","icon":"./icon.png","runtime":"./Fn.tsx","rtType":"js","visibility":false}'),e=JSON.parse('{"visibility":false,"title":"变量","namespace":"mybricks.core-comlib.var","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"变量","icon":"./icon.png","data":"./data.json","runtime":"./Var.tsx","editors":"./editors.tsx","rtType":"js","inputs":[{"id":"get","title":"读取","schema":{"type":"any"},"rels":["return"]},{"id":"set","title":"赋值","schema":{"type":"follow"},"rels":["return"]},{"id":"reset","title":"重置","schema":{"type":"any"}}],"outputs":[{"id":"return","title":"完成","schema":{"type":"unknown"}},{"id":"changed","title":"当值发生变化","schema":{"type":"unknown"}}]}');function t(i){if(i&&typeof i=="object")try{return i instanceof FormData?i:JSON.parse(JSON.stringify(i))}catch{return i}return i}const n=JSON.parse('{"title":"类型转换","visibility":false,"namespace":"mybricks.core-comlib.type-change","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"类型转换","icon":"./icon.png","runtime":"./rt.tsx","editors":"./editors.tsx","rtType":"js","inputs":[{"id":"from","title":"从","schema":{"type":"follow"},"rels":["to"]}],"outputs":[{"id":"to","title":"到","schema":{"type":"follow"},"conMax":1,"editable":true}]}');var s=__webpack_require__(356);const c=JSON.parse('{"deprecated":true,"visibility":false,"title":"连接器","namespace":"mybricks.core-comlib.connector","author":"MyBricks","author_name":"MyBricks","version":"1.0.0","description":"连接器","runtime":"./runtime.ts","editors":"./editors.tsx","icon":"./icon.svg","rtType":"js-autorun","inputs":[{"id":"call","rels":["then","catch"],"title":"调用","schema":{"type":"object"}}],"outputs":[{"id":"then","title":"结果","schema":{"type":"unknown"}},{"id":"catch","title":"发生错误","schema":{"type":"string"}}]}');function l({env:i,data:d,outputs:j,onError:v},f={}){if(d.connector)try{i.callConnector(d.connector,f,d.connectorConfig).then(w=>{j.then(w)}).catch(w=>{j.catch(w)})}catch(w){console.error(w),j.catch(`执行错误 ${w.message||w}`)}else j.catch("没有选择接口")}const h=JSON.parse('{"visibility":false,"title":"作用域输入","namespace":"mybricks.core-comlib.frame-input","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"作用域输入","rtType":"js","runtime":"./runtime.ts","editors":"./editor.tsx","inputs":[{"id":"getCurValue","title":"获取","schema":{"type":"any"},"rels":["return"]}],"outputs":[{"id":"return","title":"结果","schema":{"type":"follow"}}]}'),_=JSON.parse('{"visibility":false,"title":"打开对话框","namespace":"mybricks.core-comlib.scenes","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"切换场景","icon":"./icon.png","runtime":"./runtime.ts","data":"./data.json","rtType":"js","inputs":[{"id":"open","title":"打开","schema":{"type":"any"}}]}'),a=JSON.parse('{"title":"模块","namespace":"mybricks.core-comlib.module","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"模块","icon":"./icon.png","data":"./data.json","runtime":"./runtime.ts","editors":"./editors.ts"}'),r={id:"mybricks-core-comlib",title:"Mybrics核心组件库",author:"CheMingjun",icon:"",version:"1.0.1",comAray:[x({comDef:o,rt:function({inputs:i,outputs:d}){}}),x({comDef:e,rt:function({env:i,data:d,outputs:j,inputs:v,_notifyBindings:f}){v.get((w,O)=>{const $=t(d.val!==void 0?d.val:d.initValue);O.return($)}),v.set((w,O)=>{d.val=w;const $=t(w);j.changed($,!0),f($),O.return($)}),v.reset(()=>{const w=d.initValue;d.val=w;const O=t(w);j.changed(O,!0),f(O)})}}),x({comDef:n,rt:s.Z}),x({comDef:c,rt:function({env:i,data:d,inputs:j,outputs:v,onError:f}){i.runtime&&(d.immediate?l({env:i,data:d,outputs:v}):j.call(w=>{l({env:i,data:d,outputs:v,onError:f},w)}))}}),x({comDef:h,rt:function({env:i,data:d,inputs:j,outputs:v}){i.runtime&&j.getCurValue((f,w)=>{w.return(f)})}}),x({comDef:_,rt:function({env:i,data:d,inputs:j,_inputs:v,_inputsCallable:f}){j.open(w=>{i.canvas.open(d._sceneId,w,d._sceneShowType==="popup"?null:d.openType),f._open(w)})}}),x({comDef:a,rt:function({env:i,data:d,inputs:j,outputs:v}){const f=i.getModuleJSON(d.definedId);return i.renderCom(f,{ref(w){if(i.runtime){const{inputs:O,outputs:$}=f;O.forEach(({id:N})=>{j[N](A=>{w.inputs[N](A)})}),$.forEach(({id:N})=>{w.outputs(N,v[N])})}w.run()},disableAutoRun:!0})}})]},b=r;function g(i){return r.comAray.find(d=>d.namespace===i)}function x({comDef:i,rt:d,data:j}){return Object.assign(i,{runtime:d,data:j})}})(),__webpack_exports__})())})(comlibCore);var comlibCoreExports=comlibCore.exports;const coreLib=getDefaultExportFromCjs(comlibCoreExports),globalKey="__IOEventList__",ioLogger={log:(...o)=>{window[globalKey]||(window[globalKey]=[]),window[globalKey].push(o[0]),console.log(...o)}};function log(o){console.log(`%c[Mybricks]%c ${o}
`,"color:#FFF;background:#fa6400","","")}function logInputVal(o,e,t,n){let s;try{s=JSON.stringify(n)}catch{s=n}ioLogger.log(`%c[Mybricks] 输入项 %c ${o||e.title||e.namespace} | ${t} -> ${s}`,"color:#FFF;background:#000","","")}function logOutputVal(o,e,t,n){let s;try{s=JSON.stringify(n)}catch{s=n}ioLogger.log(`%c[Mybricks] 输出项 %c ${o||e.title||e.namespace} | ${t} -> ${s}`,"color:#FFF;background:#fa6400","","")}function isNumber(o){return typeof o=="number"&&!isNaN(o)}function uuid$1(o=5,e=8){const t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=[];if(e=e||t.length,o)for(let s=0;s<o;s++)n[s]=t[0|Math.random()*e];else{let s;n[8]=n[13]=n[18]=n[23]="-",n[14]="4";for(let c=0;c<36;c++)n[c]||(s=0|Math.random()*16,n[c]=t[c==19?s&3|8:s])}return n.join("")}function convertCamelToHyphen(o){return o.replace(/([A-Z])/g,"-$1").toLowerCase()}const toFixed=function o(e,t){var n=Math.pow(10,t+1),s=Math.floor(e*n);return Math.round(s/10)*10/n},createPxReplacer=function o(e,t,n,s){return function(c,l){var h=parseFloat(l);return!l||h<=t?c:"".concat(toFixed(h/e,n)).concat(s)}},remReplace=createPxReplacer(12,0,5,"rem"),vwReplace=createPxReplacer(3.75,0,5,"vw"),REG_PX=/"[^"]+"|'[^']+'|url\([^)]+\)|(\d*\.?\d+)px/g,pxToRem=o=>o.replace(REG_PX,remReplace),pxToVw=o=>o.replace(REG_PX,vwReplace);function dataSlim(o){return o}const ROOT_FRAME_KEY="_rootFrame_";function executor(o,{observable:e}){const{json:t,getComDef:n,env:s,ref:c,onError:l,logger:h,debug:_,debugLogger:a}=o,r=o.scenesOperate||s.scenesOperate,{slot:b,coms:g={},comsAutoRun:x={},cons:i=[],pinRels:d={},pinProxies:j={},pinValueProxies:v={},type:f}=t,w=s,O={},$={},N={},A={},D={};Object.keys(i).forEach(y=>{const m=i[y],{startPinParentKey:u}=m[0];u&&(D[u]=y)});const L={},ne={};function ae(y,m){if(y==="com"){const{com:u,pinHostId:I,val:S,fromCon:F,notifyAll:p,comDef:C}=m;a?a("com","output",{id:u.id,pinHostId:I,val:S,fromCon:F,notifyAll:p,comDef:C,sceneId:t.id}):logOutputVal(u.title,C,I,S)}else if(y==="frame"){const{comId:u,frameId:I,pinHostId:S,val:F,sceneId:p}=m;a&&a("frame","output",{comId:u,frameId:I,pinHostId:S,val:F,sceneId:p})}}function fe(y){const{com:m,pinHostId:u,val:I,frameKey:S,finishPinParentKey:F,comDef:p}=y;a?a("com","input",{id:m.id,pinHostId:u,val:I,frameKey:S,finishPinParentKey:F,comDef:p,sceneId:t.id}):logInputVal(m.title,p,u,I)}function ue(y,m,u,I,S){function F(p,C){var P,T;const E=j[p.comId+"-"+p.pinId];if(E){if(ne[`${E.frameId}-${E.pinId}`]=m,I&&I.finishPinParentKey!==p.startPinParentKey)return;if(E.type==="frame"){const R=ie(p.comId,C);let M;M={id:uuid$1(10,16),frameId:E.frameId,parent:C,proxyComProps:R};const G=p.def.namespace==="mybricks.core-comlib.frame-output";G&&C&&(E.frameId=C.proxyComProps.id,M=C.parent),Z(E,m,M),G||q({frameId:E.frameId,scope:M});return}}if(p.type==="com")I?I.finishPinParentKey===p.startPinParentKey&&B(p,m,C):B(p,m,C);else if(p.type==="frame"){if(I&&I.finishPinParentKey!==p.startPinParentKey)return;if(p.comId){if(p.direction==="inner-input"){const R=$[p.comId+"-"+p.frameId+"-"+((P=C==null?void 0:C.parent)!=null&&P.id?C.parent.id+"-":"")+p.pinId];R&&R(m)}else if(p.direction==="inner-output"&&p.pinType==="joint"){const R=i[p.comId+"-"+p.frameId+"-"+p.pinId];R&&ue(R,m)}}else{const R=C==null?void 0:C.proxyComProps;if(R){const M=R.outputs[p.pinId];if(M){M(m,C.parent);return}}(T=A[p.pinId])==null||T.call(A,m)}}else throw new Error("尚未实现")}y.forEach(p=>{if(_&&p.isIgnored)return;let C=u;if(S){const E=p.frameKey;if(!E)throw new Error("数据异常，请检查toJSON结果.");if(E===ROOT_FRAME_KEY)F(p,{});else{const P=E.split("-");if(P.length>=2){const T=H(P[0],P[1],null,S);T.curScope?(T.curScope!==C&&(C=T.curScope),F(p,C)):T.pushTodo(R=>{R!==C&&(C=R),F(p,C)})}}}else{const E=p.frameKey.split("-");if(E.length>=2&&!C){const P=H(E[0],E[1],null,!1);if((P==null?void 0:P.type)==="scope"&&!(P!=null&&P.curScope)){P.pushTodo(T=>{T!==C&&(C=T),F(p,C)});return}}F(p,C)}})}function ie(y,m){var Ee;const u=g[y];if(!u)return null;const I=y+(u.frameId||ROOT_FRAME_KEY);let S=O[I];S||(S=O[I]={});let F,p=m;for(!p&&u.parentComId&&u.frameId&&(p=(Ee=O[`${u.parentComId}-${u.frameId}`])==null?void 0:Ee.curScope);p;){const z=p.id+"-"+y;if(p.frameId===u.frameId){F=p.id;const k=S[z];if(k)return k;{const V=p.parentComId;if(V){if(V===u.paramId||V===u.parentComId)break}else break}}p=p.parent}const C=(F?F+"-":"")+y,E=S[C];if(E)return E;const P=u.def,T=u.model,R=JSON.parse(JSON.stringify(T.data)),M=JSON.parse(JSON.stringify(T.style));M.__model_style__=!0;const G={},ee={},J={},K=(z,k,V,X)=>{let U=ee[z];U||(ee[z]=U=[]),U.push({val:k,fromCon:V,fromScope:X})},Y=function(z){return new Proxy({},{ownKeys(k){return u.inputs},getOwnPropertyDescriptor(k){return{enumerable:!0,configurable:!0}},get(k,V){return function(X){if(Object.prototype.toString.call(V)==="[object Symbol]")return;const U=z==null?void 0:z.inputs;if(U){const W=U[V];typeof W=="function"&&W(X)}G[V]=X;const te=ee[V];te&&(te.forEach(({val:W,fromCon:le,fromScope:me})=>{X(W,new Proxy({},{get(ye,Ce){return function(ve){if(Object.prototype.toString.call(Ce)==="[object Symbol]")return;const ge=pe()[Ce];if(typeof ge=="function")ge(ve,me||p,le);else throw new Error(`outputs.${Ce} not found`)}}}))}),ee[V]=void 0)}}})},oe=new Proxy({},{get(z,k){return function(V){if(Object.prototype.toString.call(k)==="[object Symbol]")return;const X=d[y+"-"+k];if(X){const U={},te={};return X.forEach(W=>{U[W]=le=>{te[W]=le}}),Promise.resolve().then(()=>{B({comId:y,def:P,pinId:k},V,m,te)}),U}else B({comId:y,def:P,pinId:k},V,m)}}}),ce=new Proxy({},{get(z,k){return function(V){if(Object.prototype.toString.call(k)==="[object Symbol]")return;const X=j[y+"-"+k];X&&(r==null||r.inputs({...X,value:V,parentScope:de}))}}}),pe=function(z){return new Proxy({},{ownKeys(k){return u.outputs},getOwnPropertyDescriptor(k){return{enumerable:!0,configurable:!0}},get(k,V,X){const U=function(te,W,le,me){if(Object.prototype.toString.call(V)==="[object Symbol]")return;const ye=typeof W=="boolean"&&W;if(u.global&&ye&&!me){r==null||r.exeGlobalCom({com:u,value:te,pinId:V});return}const Ce=arguments,ve=z==null?void 0:z.outputs;if(ve){const he=ve[V];typeof he=="function"&&he(te)}let ge;W&&typeof W=="object"&&(ge=W);const Te=n(P);ae("com",{com:u,pinHostId:V,val:te,fromCon:le,notifyAll:ye,comDef:Te});const Fe=T.outputEvents;let re;if(Fe){const he=Fe[V];if(he&&Array.isArray(he)){const Ie=he.find($e=>$e.active);if(Ie){const{type:$e}=Ie;switch($e){case"none":re=[];break;case"fx":const Se=j[y+"-"+V];if((Se==null?void 0:Se.type)==="frame"){const be=`${Se.frameId}-${Se.pinId}`;re=i[be]||[],ne[be]=te}else re=[];break;case"defined":break;default:if(re=[],Array.isArray(s==null?void 0:s.events)){const be=s.events.find(Re=>{if(Re.type===$e)return Re});be&&typeof be.exe=="function"&&be.exe({options:Ie.options})}break}}}}re=re||i[y+"-"+V],re!=null&&re.length&&(Ce.length>=3?ue(re,te,ge,le):ue(re,te,ge||m,le,ye))};return U.getConnections=()=>i[y+"-"+V]||[],U}})},se=new Proxy({},{get(z,k,V){return function(X){if(Object.prototype.toString.call(k)==="[object Symbol]")return;const U=J[k];U&&(U.forEach(te=>{X(te)}),J[k]=void 0)}}}),Oe=new Proxy({},{get(z,k,V){return function(X){if(Object.prototype.toString.call(k)==="[object Symbol]")return;const U=i[y+"-"+k];U&&(ae("com",{com:u,pinHostId:k,val:X,comDef:P}),ue(U,X,m))}}});function _e(z){if(u.global){r==null||r._notifyBindings(z,u);return}const{bindingsTo:k}=u.model;if(k)for(let V in k){const X=ie(V);if(X){const U=k[V];Array.isArray(U)&&U.forEach(te=>{let W=X;const le=te.split(".");le.forEach((me,ye)=>{ye!==le.length-1?W=W[me]:W[me]=z})})}}}const de={id:u.id,title:u.title,frameId:u.frameId,parentComId:u.parentComId,data:e(R),style:e(M),_inputRegs:G,addInputTodo:K,inputs:Y(),inputsCallable:oe,_inputsCallable:ce,outputs:pe(),_inputs:se,_outputs:Oe,clone(z){const k={inputs:Y(z),outputs:pe(z)};return Object.setPrototypeOf(k,this),k},_notifyBindings:_e,logger:h,onError:_?z=>l({comId:y,error:z}):l};return S[C]=de,de}function xe(y,m){let u=ne[`${y}${m?`-${m.id}-${m.frameId}`:""}`];return typeof u>"u"&&(m!=null&&m.parent)&&(u=xe(y,m.parent)),u}function B(y,m,u,I){var T;const{comId:S,def:F,pinId:p,pinType:C,frameKey:E,finishPinParentKey:P}=y;if(C==="ext"){const R=O[S]||ie(S,u);if(p==="show")R.style.display="";else if(p==="hide")R.style.display="none";else if(p==="showOrHide"){const G=R.style;typeof m>"u"?G.display==="none"?G.display="":G.display="none":G.display=m?"":"none"}const M=n(F);fe({com:R,val:m,pinHostId:p,frameKey:E,finishPinParentKey:P,comDef:M})}else if(C==="config"){const R=ie(S,u),M=n(F);fe({com:R,pinHostId:p,val:m,frameKey:E,finishPinParentKey:P,comDef:M});const{extBinding:G}=y,ee=G.split(".");let J=R;ee.forEach((K,Y)=>{Y!==ee.length-1?J=J[K]:J[K]=m})}else if((T=F.rtType)!=null&&T.match(/^js/gi)){const R=g[S];if(R){const M=ie(S,u),G=n(F);if(R.global){const se=r==null?void 0:r.getGlobalComProps(S);se&&(M.data=se.data)}const ee=u==null?void 0:u.id,J=(ee?ee+"-":"")+S;fe({com:R,val:m,pinHostId:p,frameKey:E,finishPinParentKey:P,comDef:G}),N[J]||(N[J]=!0,G.runtime({env:w,data:M.data,inputs:M.inputs,outputs:M.outputs,_notifyBindings:M._notifyBindings,_inputsCallable:M._inputsCallable,logger:h,onError:_?se=>l({comId:S,error:se}):l}));const{realId:K,realVal:Y,isReady:oe,isMultipleInput:ce}=je(y,m,M);typeof M._inputRegs[K]=="function"&&(ce&&oe||!ce)&&M._inputRegs[K](Y,new Proxy({},{get(se,Oe){return function(_e){if(Object.prototype.toString.call(Oe)!=="[object Symbol]"){if(v){const de=v[`${S}-${p}`];de&&(_e=xe(`${E}-${de.pinId}`,u),typeof _e>"u"&&(_e=xe(`${E}-${de.pinId}`,null)))}M.outputs[Oe](_e,u,y)}}}}))}}else{const R=ie(S,u);if(!R)return;const M=n(F);fe({com:R,pinHostId:p,val:m,frameKey:E,finishPinParentKey:P,comDef:M});const{realId:G,realVal:ee,isReady:J,isMultipleInput:K}=je(y,m,R),Y=R._inputRegs[G];if(K&&J||!K)if(typeof Y=="function"){let oe;I?oe=I:oe=new Proxy({},{get(ce,pe){return function(se){Object.prototype.toString.call(pe)!=="[object Symbol]"&&R.outputs[pe](se,u,y)}}}),Y(ee,oe)}else R.addInputTodo(G,ee,y,u)}if(P){const R=i[D[P]];R&&!d[`${S}-${p}`]&&ue(R,void 0)}}function je(y,m,u){const{pinId:I,comId:S}=y,F=I.indexOf(".");if(F!==-1){let p=I.substring(0,F);const C=I.substring(F+1);let E=L[S];E||(E=L[S]={}),E[C]=m;const P=new RegExp(`${p}.`),T=Object.keys(u.inputs).filter(R=>!!R.match(P));return Object.keys(E).length===T.length?(delete L[S],{isMultipleInput:!0,isReady:!0,realId:p,realVal:E}):{isMultipleInput:!0,isReady:!1}}return{isMultipleInput:!1,isReady:!0,realId:I,realVal:m}}function we(y,m){let u;return y!=null&&y.comAry&&y.comAry.find(I=>{if(I.id===m)return u=I,I;if(I.slots){for(let S in I.slots)if(u=we(I.slots[S],m),u)return u}}),u}function H(y,m,u,I){let S=y+"-"+m+(u?`-${u.id}`:""),F=O[S];if(I&&!F&&(F=O[Object.keys(O).find(p=>p.startsWith(S))]),!F){const p=we(b,y);if(!(p!=null&&p.slots))return null;const C=p==null?void 0:p.slots[m],E={};let P;if(u){const J=O[y+"-"+m];J&&(P=J.todo)}const T={scope:u,todo:P},R=new Proxy({},{get(J,K){return function(Y){Object.prototype.toString.call(K)!=="[object Symbol]"&&(E[K]=Y)}}}),M=new Proxy({},{get(J,K){const Y=function(oe,ce){if(Object.prototype.toString.call(K)==="[object Symbol]")return;const pe=y+"-"+m+"-"+K,se=i[pe];ne[`${pe}${ce?`-${ce.id}-${ce.frameId}`:""}`]=oe,ae("frame",{comId:y,frameId:m,pinHostId:K,val:oe}),se&&ue(se,oe,ce||T.scope)};return Y.getConnections=()=>i[y+"-"+m+"-"+K]||[],Y}}),G=new Proxy({},{get(J,K,Y){return function(oe){Object.prototype.toString.call(K)!=="[object Symbol]"&&($[S+"-"+K]=oe)}}});let ee={};F=O[S]={type:C==null?void 0:C.type,run(J){T.scope=J;const K=(J==null?void 0:J.id)||"none";ee[K]||(ee[K]=!0,q({comId:y,frameId:m,scope:J})),Array.isArray(T.todo)&&(T.todo.forEach(Y=>{Promise.resolve().then(()=>{Y(J)})}),T.todo=void 0)},destroy(){Reflect.deleteProperty(O,S)},_inputs:R,_inputRegs:E,inputs:M,outputs:G,get curScope(){return T.scope},get todo(){return T.todo},pushTodo(J){T.todo||(T.todo=[]),T.todo.push(J)}}}return F}function q(y){const{comId:m,frameId:u,scope:I}=y,S=m?`${m}-${u}`:`${u}`,F=x[S];F&&F.forEach(p=>{const{id:C,def:E}=p;if(g[C]){const T=ie(C,I),R=n(E);log(`${R.namespace} 开始执行`),R.runtime({env:w,data:T.data,inputs:T.inputs,outputs:T.outputs,_inputsCallable:T._inputsCallable,logger:h,onError:_?M=>l({comId:C,error:M}):l})}})}function Z(y,m,u=void 0,I=!0){const{frameId:S,comId:F,pinId:p,sceneId:C}=y,E=F?`${F}-${S}`:`${S}`,P=i[E+"-"+p];ne[`${S}-${p}`]=m,I&&ae("frame",{comId:F,frameId:S,pinHostId:p,val:m,sceneId:C}),P?ue(P,m,u):S!==ROOT_FRAME_KEY&&(t.id===S?A[p](m):r==null||r.open({frameId:S,todo:{pinId:p,value:m},parentScope:u.proxyComProps}))}const Q={get(y,m,u,I){let S,F,p;for(let C=0;C<arguments.length;C++){const E=arguments[C];C>0&&typeof E=="string"&&(S=E),typeof E=="object"&&(E.inputs||E.outputs||E._inputs||E._outputs?p=E:(E.id||E.parent)&&(F=E))}if(S)return H(y,S,F);{const C=ie(y,F);return p?C.clone(p):C}},getComInfo(y){return g[y]}};if(typeof c=="function"){const y={run(){q({frameId:ROOT_FRAME_KEY})},inputs:new Proxy({},{get(m,u){return function(I,S=void 0,F=!0){Object.prototype.toString.call(u)!=="[object Symbol]"&&Z({frameId:ROOT_FRAME_KEY,pinId:u,sceneId:S},I,void 0,F)}}}),outputs(m,u){A[m]=u},get:Q.get,getComInfo:Q.getComInfo};s._context&&f==="module"&&s._context.setRefs(t.id,y),c(y)}return Q}function normalizeComponent(o,e,t,n,s,c,l,h){var _=typeof o=="function"?o.options:o;e&&(_.render=e,_.staticRenderFns=t,_._compiled=!0),n&&(_.functional=!0),c&&(_._scopeId="data-v-"+c);var a;if(l?(a=function(g){g=g||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!g&&typeof __VUE_SSR_CONTEXT__<"u"&&(g=__VUE_SSR_CONTEXT__),s&&s.call(this,g),g&&g._registeredComponents&&g._registeredComponents.add(l)},_._ssrRegister=a):s&&(a=h?function(){s.call(this,(_.functional?this.parent:this).$root.$options.shadowRoot)}:s),a)if(_.functional){_._injectStyles=a;var r=_.render;_.render=function(x,i){return a.call(i),r(x,i)}}else{var b=_.beforeCreate;_.beforeCreate=b?[].concat(b,a):[a]}return{exports:o,options:_}}const _sfc_main$6={props:{slotId:{type:String},propsSlot:{type:Object},params:{type:Object},props:{type:Object},propsStyle:{type:Object},onError:{type:Function},logger:{type:Object},env:{type:Object},_env:{type:Object},scope:{type:Object},getComDef:{type:Function},context:{type:Object}},created(){let o;const{propsSlot:e,scope:t,props:n,env:s,_env:c,getComDef:l,registSpm:h,context:_,onError:a,logger:r,params:b}=this.$props;if(Object.assign(b,b.m),(e==null?void 0:e.type)==="scope"?(o={id:uuid(10,16),frameId:slotId},t&&(o.parent=t)):o=t,b){const g=b.inputValues;if(typeof g=="object")for(let x in g)n.inputs[x](g[x],o);typeof b.wrap=="function"&&b.wrap}n.run(o),this.slotProps={scope:o,env:s,_env:c,propsSlot:e,params:b,getComDef:l,registSpm:h,context:_,inputs:b==null?void 0:b.inputs,outputs:b==null?void 0:b.outputs,_inputs:b==null?void 0:b._inputs,_outputs:b==null?void 0:b._outputs,onError:a,logger:r},this.slotComponent=RenderSlot}};var _sfc_render$6=function o(){var e=this,t=e._self._c;return t(e.slotComponent,e._b({tag:"component"},"component",e.slotProps,!1))},_sfc_staticRenderFns$6=[],__component__$6=normalizeComponent(_sfc_main$6,_sfc_render$6,_sfc_staticRenderFns$6,!1,null,null,null,null);const SlotRender=__component__$6.exports,com="_com_z9da4_2",flex="_flex_z9da4_7",style0$2={com,flex},_sfc_main$5={props:{com:{type:Object},getComDef:{type:Function},registSpm:{type:Function},context:{type:Object},scope:{type:Object},props:{type:Object},env:{type:Object},_env:{type:Object},onError:{type:Function},logger:{type:Object}},components:{SlotRender},created(){var we;const{_env:o,env:e,com:t,props:n,getComDef:s,registSpm:c,onError:l,logger:h,context:_,scope:a}=this.$props,{pxToRem:r,pxToVw:b}=e,{id:g,def:x,name:i,slots:d={}}=t,{data:j,title:v,style:f,inputs:w,outputs:O,_inputs:$,_outputs:N,_notifyBindings:A}=n,D=this.getStyleAry({env:e,def:x,style:f});if(Array.isArray(D)){const H=(e==null?void 0:e.shadowRoot)||((we=document.getElementById("_mybricks-geo-webview_"))==null?void 0:we.shadowRoot);if(!(H||document).querySelector(`style[id="${g}"]`)){const q=document.createElement("style");let Z="";q.id=g,D.forEach(({css:Q,selector:y,global:m})=>{y===":root"&&(y="> *:first-child"),Z=Z+`
            ${m?"":`#${g} `}${y.replace(/\{id\}/g,`${g}`)} {
              ${Object.keys(Q).map(u=>{let I=Q[u];return r&&typeof I=="string"&&I.indexOf("px")!==-1?I=pxToRem(I):b&&typeof I=="string"&&I.indexOf("px")!==-1&&(I=pxToVw(I)),`${convertCamelToHyphen(u)}: ${I};`}).join(`
`)}
            }
          `}),q.innerHTML=Z,H?H.appendChild(q):document.head.appendChild(q)}}Reflect.deleteProperty(f,"styleAry"),Reflect.deleteProperty(f,"themesId");const L=s(x),ne=[],ae={};t.slots&&Object.entries(t.slots).forEach(([H,q])=>{const Z=_.get(g,H,a);ae[H]={get size(){var Q;return((Q=q==null?void 0:q.comAry)==null?void 0:Q.length)||0}},ne.push({slotId:H,propsSlot:q,props:Z,propsStyle:f,onError:l,logger:h,env:e,_env:o,scope:a,getComDef:s,context:_})}),this.templateSlots=ne;let fe;if(n.frameId&&n.parentComId){const H=_.get(n.parentComId,n.frameId,a==null?void 0:a.parent);H&&(fe={get _inputs(){return new Proxy({},{get(q,Z){return H._inputRegs[Z]}})}})}const ue=this.getClasses({style:f,id:g}),ie=this.getSizeStyle({style:f,env:e}),xe=this.getMarginStyle({style:f,env:e}),B={};if(["fixed","absolute"].includes(f.position)){const{top:H,left:q,right:Z,bottom:Q}=f;(H||isNumber(H))&&(B.top=isNumber(H)?H+"px":H),(Q||isNumber(Q))&&(B.bottom=isNumber(Q)?Q+"px":Q),(q||isNumber(q))&&(B.left=isNumber(q)?q+"px":q),(Z||isNumber(Z))&&(B.right=isNumber(Z)?Z+"px":Z),f.position==="fixed"&&(B.zIndex=1e3);const{pxToVw:y}=e;y&&(typeof B.top=="string"&&B.top.indexOf("px")!==-1&&(B.top=pxToVw(B.top)),typeof B.bottom=="string"&&B.bottom.indexOf("px")!==-1&&(B.bottom=pxToVw(B.bottom)),typeof B.left=="string"&&B.left.indexOf("px")!==-1&&(B.left=pxToVw(B.left)),typeof B.right=="string"&&B.right.indexOf("px")!==-1&&(B.right=pxToVw(B.right)))}this.component=L.runtime,this.comDef=L,this.containerProps={id:g,key:g,style:{display:f.display,position:f.position||"relative",...B,...ie,...xe,...f.ext||{}}},this.containerClass=ue;const je={id:g,env:{...e,pxToVw,spm:c?c==null?void 0:c(g,{title:v,namespace:x.namespace}):null},_env:o,data:j,name:i,title:v,slots:ae,propsStyle:f,inputs:w,outputs:O,_inputs:$,_outputs:N,_notifyBindings:A,parentSlot:fe,onError:l,logger:h};this.componentProps={...je,m:{...je,style:f}}},methods:{getStyleAry({env:o,def:e,style:t}){var h;const n=(h=o==null?void 0:o.themes)==null?void 0:h.comThemes;if(!n)return t.styleAry;let s;const{themesId:c}=t,{namespace:l}=e;if(c)if(c==="_defined")s=t.styleAry;else{const _=n[l];if(Array.isArray(_)){const a=_.find(({id:r})=>r===c);a&&(s=a.styleAry)}}else{const _=n[l];if(Array.isArray(_)){const a=_.find(({isDefault:r})=>r);a&&(s=a.styleAry)}}return s||t.styleAry},getClasses({style:o,id:e}){const t=[e,this.$style.com];return o.flex===1&&t.push(this.$style.flex),t.join(" ")},getSizeStyle({style:o,env:e}){const t={},{width:n,height:s}=o;n?isNumber(n)?t.width=n+"px":n&&(t.width=n):t.width="100%",isNumber(s)?t.height=s+"px":s&&(t.height=s);const{pxToVw:c}=e;return c&&(typeof t.width=="string"&&t.width.indexOf("px")!==-1&&(t.width=pxToVw(t.width)),typeof t.height=="string"&&t.height.indexOf("px")!==-1&&(t.height=pxToVw(t.height))),t},getMarginStyle({style:o,env:e}){const t={},{width:n,marginTop:s,marginLeft:c,marginRight:l,marginBottom:h}=o;isNumber(s)&&(t.marginTop=s+"px"),isNumber(c)&&(typeof n=="number"||c<0?t.marginLeft=c+"px":t.paddingLeft=c+"px"),isNumber(l)&&(typeof n=="number"||l<0?t.marginRight=l+"px":t.paddingRight=l+"px"),isNumber(h)&&(t.marginBottom=h+"px");const{pxToVw:_}=e;return _&&(typeof t.marginTop=="string"&&t.marginTop.indexOf("px")!==-1&&(t.marginTop=pxToVw(t.marginTop)),typeof t.marginLeft=="string"&&t.marginLeft.indexOf("px")!==-1&&(t.marginLeft=pxToVw(t.marginLeft)),typeof t.marginRight=="string"&&t.marginRight.indexOf("px")!==-1&&(t.marginRight=pxToVw(t.marginRight)),typeof t.marginBottom=="string"&&t.marginBottom.indexOf("px")!==-1&&(t.marginBottom=pxToVw(t.marginBottom)),typeof t.paddingLeft=="string"&&t.paddingLeft.indexOf("px")!==-1&&(t.paddingLeft=pxToVw(t.paddingLeft)),typeof t.paddingRight=="string"&&t.paddingRight.indexOf("px")!==-1&&(t.paddingRight=pxToVw(t.paddingRight))),t},getSlotProps(){}}};var _sfc_render$5=function o(){var e=this,t=e._self._c;return t("div",e._b({class:e.containerClass},"div",e.containerProps,!1),[t(e.component,e._b({tag:"component",scopedSlots:e._u([e._l(e.templateSlots,function(n){return{key:n.slotId,fn:function(s){return[t("SlotRender",e._b({},"SlotRender",{...n,params:s},!1))]}}})],null,!0)},"component",e.componentProps,!1))],1)},_sfc_staticRenderFns$5=[];const __cssModules$2={$style:style0$2};function _sfc_injectStyles$2(o){for(var e in __cssModules$2)this[e]=__cssModules$2[e]}var __component__$5=normalizeComponent(_sfc_main$5,_sfc_render$5,_sfc_staticRenderFns$5,!1,_sfc_injectStyles$2,null,null,null);const RenderCom=__component__$5.exports,slot="_slot_rwhgo_1",lyFlexColumn="_lyFlexColumn_rwhgo_6",lyFlexRow="_lyFlexRow_rwhgo_10",justifyContentFlexStart="_justifyContentFlexStart_rwhgo_14",justifyContentFlexCenter="_justifyContentFlexCenter_rwhgo_17",justifyContentFlexFlexEnd="_justifyContentFlexFlexEnd_rwhgo_20",justifyContentFlexSpaceAround="_justifyContentFlexSpaceAround_rwhgo_23",justifyContentFlexSpaceBetween="_justifyContentFlexSpaceBetween_rwhgo_26",alignItemsFlexStart="_alignItemsFlexStart_rwhgo_29",alignItemsFlexCenter="_alignItemsFlexCenter_rwhgo_32",alignItemsFlexFlexEnd="_alignItemsFlexFlexEnd_rwhgo_35",debugFocus="_debugFocus_rwhgo_38",error="_error_rwhgo_42",errorRT="_errorRT_rwhgo_47",tt="_tt_rwhgo_51",info="_info_rwhgo_57",style0$1={slot,lyFlexColumn,lyFlexRow,justifyContentFlexStart,justifyContentFlexCenter,justifyContentFlexFlexEnd,justifyContentFlexSpaceAround,justifyContentFlexSpaceBetween,alignItemsFlexStart,alignItemsFlexCenter,alignItemsFlexFlexEnd,debugFocus,error,errorRT,tt,info},_sfc_main$4={props:{env:{type:Object},propsStyle:{type:Object},_env:{type:Object},propsSlot:{type:Object},getComDef:{type:Function},registSpm:{type:Function},context:{type:Object},className:{type:String},onError:{type:Function},logger:{type:Object},root:{type:Boolean},scope:{type:Object},inputs:{type:Object},outputs:{type:Object},_inputs:{type:Object},_outputs:{type:Object},params:{type:Object}},created(){},computed:{comAry(){const{env:o,_env:e,propsSlot:t,context:n,getComDef:s,registSpm:c,onError:l,logger:h,scope:_,inputs:a,_inputs:r,outputs:b,_outputs:g}=this.$props,{comAry:x}=t,i=[];return x.forEach((d,j)=>{var D;const{id:v,def:f,name:w}=d,O=n.getComInfo(v),{hasPermission:$}=o,N=(D=O==null?void 0:O.model)==null?void 0:D.permissions;if(N&&typeof $=="function"&&!$(N.id))return;if(s(f)){const L=n.get(v,_,{inputs:a,outputs:b,_inputs:r,_outputs:g}),ne=(_?_.id:"")+j;i.push({id:v,props:{key:ne,com:d,getComDef:s,registSpm:c,context:n,scope:_,props:L,env:o,_env:e,onError:l,logger:h},component:RenderCom,name:w,inputs:L.inputsCallable,style:L.style})}else console.error(`组件 (namespace = {${f.namespace}}）未找到.`)}),i},classes(){const{root:o,className:e,params:t,propsStyle:n}=this.$props,c=(t==null?void 0:t.style)||(t==null?void 0:t._style)||n;return`${this.calSlotClasses(c||{})}${o&&e?` ${e}`:""}`},styles(){const{root:o,propsStyle:e,params:t}=this.$props,n=(t==null?void 0:t.style)||(t==null?void 0:t._style),s=n||e;return{...this.calSlotStyles(s||{},!!n,o),...e}}},methods:{calSlotStyles(o,e,t){const{paddingLeft:n,paddingTop:s,paddingRight:c,paddingBottom:l,background:h,backgroundColor:_,backgroundImage:a,backgroundPosition:r,backgroundRepeat:b,backgroundSize:g,...x}=o;let i={paddingLeft:n||0,paddingTop:s||0,paddingRight:c||0,paddingBottom:l||0,backgroundColor:_,backgroundImage:a,backgroundPosition:r,backgroundRepeat:b,backgroundSize:g};if(h)if(typeof h=="object"){const{background:j,backgroundImage:v,backgroundColor:f,backgroundRepeat:w,backgroundSize:O}=h;i.backgroundRepeat=w,i.backgroundSize=O,j?i.background=j:(i.backgroundImage=v,i.backgroundColor=f)}else i.background=h;return e&&(i=Object.assign(i,x)),i},calSlotClasses(o){var s,c;const e=this.$style,t=[e.slot,"slot"],n=o;if(n){((s=n.layout)==null?void 0:s.toLowerCase())=="flex-column"?t.push(e.lyFlexColumn):((c=n.layout)==null?void 0:c.toLowerCase())=="flex-row"&&t.push(e.lyFlexRow);const l=n.justifyContent;l&&(l.toUpperCase()==="FLEX-START"?t.push(e.justifyContentFlexStart):l.toUpperCase()==="CENTER"?t.push(e.justifyContentFlexCenter):l.toUpperCase()==="FLEX-END"?t.push(e.justifyContentFlexFlexEnd):l.toUpperCase()==="SPACE-AROUND"?t.push(e.justifyContentFlexSpaceAround):l.toUpperCase()==="SPACE-BETWEEN"&&t.push(e.justifyContentFlexSpaceBetween));const h=n.alignItems;h&&(h.toUpperCase()==="FLEX-START"?t.push(e.alignItemsFlexStart):h.toUpperCase()==="CENTER"?t.push(e.alignItemsFlexCenter):h.toUpperCase()==="FLEX-END"&&t.push(e.alignItemsFlexFlexEnd))}return t.join(" ")}}};var _sfc_render$4=function o(){var e=this,t=e._self._c;return t("div",{class:e.classes,style:e.styles,attrs:{"data-isslot":"1"}},[e._l(e.comAry,function(n){return t(n.component,e._b({key:n.id,tag:"component"},"component",n.props,!1))}),t("div")],2)},_sfc_staticRenderFns$4=[];const __cssModules$1={$style:style0$1};function _sfc_injectStyles$1(o){for(var e in __cssModules$1)this[e]=__cssModules$1[e]}var __component__$4=normalizeComponent(_sfc_main$4,_sfc_render$4,_sfc_staticRenderFns$4,!1,_sfc_injectStyles$1,null,null,null);const RenderSlot=__component__$4.exports,_sfc_main$3={components:{RenderSlot},props:{json:{type:Object},opts:{type:Object},propsStyle:{type:Object},className:{type:String},root:{type:Boolean}},created(){const{json:o,opts:e}=this.$props;this.hasUi=o.rtType!=="js";let t={};e.comDefs&&Object.assign(t,e.comDefs);let n=[...window.__comlibs_edit_||[],...window.__comlibs_rt_||[]];n.push(coreLib),n.forEach(s=>{const c=s.comAray;c&&Array.isArray(c)&&this.regAry(c,t)}),this.comDefs=t,e.env.renderCom||(e.env.renderCom=(s,c)=>render(s,{...c,env}));try{let s,c=!0;const l=executor({json:o,getComDef:this.getComDef,events:e.events,env:e.env,ref(h){s=h,typeof e.ref=="function"&&(e.ref(h),c=!1)},onError:this.onError,debug:e.debug,debugLogger:e.debugLogger,logger:this.logger,scenesOperate:e.scenesOperate},{observable:e.observable||Vue.observable});this.context=l,this.refs=s,this.activeTriggerInput=c}catch(s){throw console.error(s),new Error("导出的JSON.script执行异常.")}},mounted(){const{opts:o,json:e}=this.$props;if(!o.disableAutoRun){if(this.activeTriggerInput){const{inputs:t}=this.refs,n=e.inputs;t&&Array.isArray(n)&&n.forEach(s=>{const{id:c,mockData:l}=s;let h;if(o.debug&&typeof l<"u")try{h=JSON.parse(decodeURIComponent(l))}catch{h=l}t[c](h)})}refs.run()}},computed:{logger(){return{...console}},onError(){return o=>{console.error(o)}},props(){const{json:o,opts:e,propsStyle:t,className:n,root:s=!0}=this.$props;return{env:e.env,propsStyle:t,_env:e._env,registSpm:e.registSpm,propsSlot:o.slot,getComDef:this.getComDef,context:this.context,className:n,onError:this.onError,logger:this.logger,root:s}}},methods:{regAry(o,e){o.forEach(t=>{t.comAray?this.regAry(t.comAray,e):e[`${t.namespace}-${t.version}`]=t})},getComDef(o){const{comDefs:e}=this,t=e[o.namespace+"-"+o.version];if(!t){const n=[];for(let s in e)s.startsWith(o.namespace+"-")&&n.push(e[s]);if(n&&n.length>0){n.sort((c,l)=>compareVersion(c.version,l.version));const s=n[0];return console.warn(`【Mybricks】组件${o.namespace+"@"+o.version}未找到，使用${s.namespace}@${s.version}代替.`),s}else throw console.log(e),new Error(`组件${o.namespace+"@"+o.version}未找到，请确定是否存在该组件以及对应的版本号.`)}return t}}};var _sfc_render$3=function o(){var e=this,t=e._self._c;return e.hasUi?t("RenderSlot",e._b({},"RenderSlot",e.props,!1)):e._e()},_sfc_staticRenderFns$3=[],__component__$3=normalizeComponent(_sfc_main$3,_sfc_render$3,_sfc_staticRenderFns$3,!1,null,null,null,null);const Main=__component__$3.exports,main="_main_1oukw_14",slipInto="_slipInto_1oukw_1",style0={main,slipInto},_sfc_main$2={components:{Main},props:{json:{type:Object},opts:{type:Object}},data(){return{count:0,popupIds:[],pageScenes:[]}},created(){const{json:o,opts:e}=this.$props;if(e.sceneId){const _=o.scenes.findIndex(a=>a.id===e.sceneId);if(_!==-1){const a=o.scenes.splice(_,1);o.scenes.unshift(...a),a[0].type==="popup"&&this.setPopupIds([a[0].id])}}const t=[];o.scenes.forEach((_,a)=>{_.type==="popup"?a||this.setPopupIds([_.id]):t.push(_)}),this.setPageScenes(t);const{modules:n,definedComs:s}=o;if(e.env.getDefinedComJSON||(e.env.getDefinedComJSON=_=>s[_].json),e.env.getModuleJSON||(e.env.getModuleJSON=_=>{var i;const a=(i=n==null?void 0:n[_])==null?void 0:i.json;if(!a)return a;const{global:r}=o;let b={},g={},x={};return r&&(b=r.comsReg,g=r.consReg,x=r.pinRels,Object.keys(b).forEach(d=>{b[d].global=!0})),Object.assign(a.coms,b),Object.assign(a.cons,g),Object.assign(a.pinRels,x),a}),this.scenesMap=o.scenes.reduce((_,a,r)=>{var b;return{..._,[a.id]:{show:r===0,todo:[],json:a,disableAutoRun:!!r,useEntryAnimation:!1,type:((b=a.slot)==null?void 0:b.showType)||a.type}}},{}),this.scenesOperateInputsTodo={},this.themes=o.themes,this.permissions=o.permissions||[],this.globalVarMap={},e.ref){const _=e.ref;e.ref=a=>r=>(a(r),_.call(e,r))}else e.ref=_=>a=>{_(a)};const c={},l=[],{global:h}=o;if(h){const{fxFrames:_}=h;Array.isArray(_)&&_.forEach(a=>{var v;const{id:r}=a,b={};c[r]=b;const g={open({todo:f,frameId:w,parentScope:O}){const $=c[w];$!=null&&$._refs&&($.parentScope=O,$._refs.inputs[f.pinId](f.value,void 0,!1),$._refs.run())},inputs({frameId:f,parentScope:w,value:O,pinId:$}){const N=scenesMap[f];N?(N.parentScope=w,N._refs?N._refs.inputs[$](O):N.todo=N.todo.concat({type:"inputs",todo:{pinId:$,value:O}})):scenesOperateInputsTodo[f]?scenesOperateInputsTodo[f].todo.push({frameId:f,parentScope:w,value:O,pinId:$}):scenesOperateInputsTodo[f]={parentScope:w,todo:[{value:O,pinId:$}]}},_notifyBindings(f,w){const{bindingsTo:O}=w.model;if(O)for(let $ in O)for(let N in scenesMap){const A=scenesMap[N];if(A.json.coms[$])if(A._refs)this._notifyBindings(A._refs,$,O[$],f);else{const L=O[$];A.todo=A.todo.concat({type:"globalVar",todo:{comId:$,bindings:L,value:f}})}}},getGlobalComProps(f){return scenesMap[o.scenes[0].id]._refs.get(f)},exeGlobalCom({com:f,value:w,pinId:O}){const $=f.id;this.globalVarMap[$]=w,Object.keys(scenesMap).forEach(A=>{const D=scenesMap[A];if(D.show&&D._refs){const L=D._refs.get($);L&&L.outputs[O](w,!0,null,!0)}});const N=e.env._context.getRefsMap();Object.entries(N).forEach(([A,D])=>{const L=D.get($);L&&L.outputs[O](w,!0,null,!0)})}},x={...e,env:{...e.env,canvas:Object.assign({id:r,type:(window==null?void 0:window.document.body.clientWidth)<=414?"mobile":"pc",open:async(f,w,O)=>{var N;let $=scenesMap[f];if(!$){if(typeof e.scenesLoader!="function"){console.error(`缺少场景信息: ${f}`);return}const A=await e.scenesLoader({id:f});if($={disableAutoRun:!1,json:A,show:!1,parentScope:null,todo:[],type:((N=A.slot)==null?void 0:N.showType)||A.type,useEntryAnimation:!1},scenesMap[f]=$,A.type==="popup"||setPageScenes(D=>[...D,A]),scenesOperateInputsTodo[f]){const{parentScope:D,todo:L}=scenesOperateInputsTodo[f];$.parentScope=D,L.forEach(({value:ne,pinId:ae,parentScope:fe})=>{$.todo=$.todo.concat({type:"inputs",todo:{pinId:ae,value:ne}})})}}O?Object.entries(scenesMap).forEach(([A,D])=>{A===f?(O==="blank"?D.useEntryAnimation=!0:D.useEntryAnimation=!1,D.show=!0,D.type==="popup"?this.setPopupIds([...this.popupIds,f]):setCount(L=>L+1)):(D.show=!1,D.type==="popup"?this.setPopupIds(this.popupIds.filter(L=>L!==D.json.id)):setCount(L=>L+1))}):$.show||(O==="blank"?$.useEntryAnimation=!0:$.useEntryAnimation=!1,$.show=!0,$.type==="popup"?this.setPopupIds([...this.popupIds,f]):setCount(A=>A+1))}},(v=e.env)==null?void 0:v.canvas)},disableAutoRun:!0,ref:e.ref(f=>{b._refs=f;const{inputs:w,outputs:O}=f;a.outputs.forEach($=>{O($.id,N=>{var A;(A=b.parentScope)==null||A.outputs[$.id](N)})})}),_env:{loadCSSLazy(){},currentScenes:{close(){}}},scenesOperate:g};let i=h.comsReg,d=h.consReg,j=h.pinRels;Object.keys(i).forEach(f=>{i[f].global=!0}),Object.assign(a.coms,i),Object.assign(a.cons,d),Object.assign(a.pinRels,j),l.push({key:r,component:Main,json:{...a,rtType:"js"},options:x})})}this.fxFramesMap=c,this.fxFramesJsx=l},computed:{scenes(){const{pageScenes:o,scenesMap:e}=this;if(!o.length)return[];const{json:t}=this.$props,{global:n}=t;let s={},c={},l={};return n&&(s=n.comsReg,c=n.consReg,l=n.pinRels,Object.keys(s).forEach(h=>{s[h].global=!0})),o.map((h,_)=>{const{id:a}=h;Object.assign(h.coms,s),Object.assign(h.cons,c),Object.assign(h.pinRels,l);const r=e[a];return{show:r.show,key:a,json:{...h,scenesMap:e},opts:this.options(a),className:r.useEntryAnimation?$style.main:"",style:r.type==="popup"?{position:"absolute",top:0,left:0,backgroundColor:"#ffffff00"}:{}}})},popups(){const{popupIds:o,scenesMap:e}=this;if(!o.length)return[];const{json:t}=this.$props,{global:n}=t;let s={},c={},l={};return n&&(s=n.comsReg,c=n.consReg,l=n.pinRels,Object.keys(s).forEach(h=>{s[h].global=!0})),o.map(h=>{const a=e[h].json,{id:r}=a;return Object.assign(a.coms,s),Object.assign(a.cons,c),Object.assign(a.pinRels,l),{key:a.id,json:{...a,scenesMap:e},opts:this.options(r),style:{position:"absolute",top:0,left:0,backgroundColor:"#ffffff00"}}})}},methods:{setCount(o){this.count=o},setPopupIds(o){this.popupIds=o},setPageScenes(o){this.pageScenes=o},options(o){var a;const{opts:e}=this.$props,{scenesMap:t,themes:n,permissions:s}=this,c=this,l=t[o],h=e.env.hasPermission,_={open({todo:r,frameId:b,parentScope:g}){const x=t[b];if(x)x.show||(x.show=!0,x.todo=x.todo.concat({type:"inputs",todo:r}),x.parentScope=g,x.type==="popup"?c.setPopupIds([...c.popupIds,b]):setCount(i=>i+1));else{const i=fxFramesMap[b];i!=null&&i._refs&&(i.parentScope=g,i._refs.inputs[r.pinId](r.value,void 0,!1),i._refs.run())}},inputs({frameId:r,parentScope:b,value:g,pinId:x}){const i=t[r];i?(i.parentScope=b,i._refs?i._refs.inputs[x](g):i.todo=i.todo.concat({type:"inputs",todo:{pinId:x,value:g}})):scenesOperateInputsTodo[r]?scenesOperateInputsTodo[r].todo.push({frameId:r,parentScope:b,value:g,pinId:x}):scenesOperateInputsTodo[r]={parentScope:b,todo:[{value:g,pinId:x}]}},_notifyBindings(r,b){const{bindingsTo:g}=b.model;if(g)for(let x in g)for(let i in t){const d=t[i];if(d.json.coms[x])if(d._refs)this._notifyBindings(d._refs,x,g[x],r);else{const v=g[x];d.todo=d.todo.concat({type:"globalVar",todo:{comId:x,bindings:v,value:r}})}}},getGlobalComProps(r){return t[json.scenes[0].id]._refs.get(r)},exeGlobalCom({com:r,value:b,pinId:g}){const x=r.id;c.globalVarMap[x]=b,Object.keys(t).forEach(d=>{const j=t[d];if(j.show&&j._refs){const v=j._refs.get(x);v&&v.outputs[g](b,!0,null,!0)}});const i=e.env._context.getRefsMap();Object.entries(i).forEach(([d,j])=>{const v=j.get(x);v&&v.outputs[g](b,!0,null,!0)})}};return{...e,env:{...e.env,themes:n,permissions:s,hasPermission:typeof h=="function"?r=>{if(typeof r=="string"){const b=s.find(g=>g.id===r);return h({permission:b})}return h(r)}:null,canvas:Object.assign({id:o,type:(window==null?void 0:window.document.body.clientWidth)<=414?"mobile":"pc",open:async(r,b,g)=>{var i;let x=t[r];if(!x){if(typeof e.scenesLoader!="function"){console.error(`缺少场景信息: ${r}`);return}const d=await e.scenesLoader({id:r});if(x={disableAutoRun:!1,json:d,show:!1,parentScope:null,todo:[],type:((i=d.slot)==null?void 0:i.showType)||d.type,useEntryAnimation:!1},t[r]=x,d.type==="popup"||setPageScenes(j=>[...j,d]),scenesOperateInputsTodo[r]){const{parentScope:j,todo:v}=scenesOperateInputsTodo[r];x.parentScope=j,v.forEach(({value:f,pinId:w,parentScope:O})=>{x.todo=x.todo.concat({type:"inputs",todo:{pinId:w,value:f}})})}}g?Object.entries(t).forEach(([d,j])=>{d===r?(g==="blank"?j.useEntryAnimation=!0:j.useEntryAnimation=!1,j.show=!0,j.type==="popup"?c.setPopupIds([...c.popupIds,r]):setCount(v=>v+1)):(j.show=!1,j.type==="popup"?c.setPopupIds(c.popupIds.filter(v=>v!==j.json.id)):setCount(v=>v+1))}):x.show||(g==="blank"?x.useEntryAnimation=!0:x.useEntryAnimation=!1,x.show=!0,x.type==="popup"?c.setPopupIds([...c.popupIds,r]):setCount(d=>d+1))}},(a=e.env)==null?void 0:a.canvas)},get disableAutoRun(){return l.disableAutoRun},ref:e.ref(r=>{l._refs=r;const b=l.todo,{inputs:g,outputs:x}=r,i=l.disableAutoRun;l.json.outputs.forEach(d=>{x(d.id,j=>{var v;l.show=!1,l.todo=[],l._refs=null,(v=l.parentScope)==null||v.outputs[d.id](j),l.parentScope=null,l.type==="popup"?c.setPopupIds(c.popupIds.filter(f=>f!==l.json.id)):setCount(f=>f+1)})}),b.length?(b.forEach(({type:d,todo:j})=>{if(d==="inputs")Promise.resolve().then(()=>{g[j.pinId](j.value,o)});else if(d==="globalVar"){const{comId:v,value:f,bindings:w}=j;c._notifyBindings(r,v,w,f)}}),l.todo=[]):i||(l.disableAutoRun=!0,Promise.resolve().then(()=>{var d,j;(j=(d=l.json.inputs)==null?void 0:d.forEach)==null||j.call(d,v=>{const{id:f,mockData:w}=v;let O;if(e.debug&&typeof w<"u")try{O=JSON.parse(decodeURIComponent(w))}catch{O=w}g[f](O)})})),i&&Promise.resolve().then(()=>{r.run()}),Object.entries(c.globalVarMap).forEach(([d,j])=>{const v=l._refs.get(d);v&&v.outputs.changed(j,!0,null,!0)})}),_env:{loadCSSLazy(){},currentScenes:{close(){l.show=!1,l.todo=[],l._refs=null,l.type==="popup"?(console.log(c,"that"),c.setPopupIds(c.popupIds.filter(r=>r!==l.json.id))):setCount(r=>r+1)}}},scenesOperate:_}},_notifyBindings(o,e,t,n){const s=o.get(e);s&&Array.isArray(t)&&t.forEach(c=>{let l=s;const h=c.split(".");h.forEach((_,a)=>{a!==h.length-1?l=l[_]:l[_]=n})})}}};var _sfc_render$2=function o(){var e=this,t=e._self._c;return t("div",[e._l(e.fxFramesJsx,function(n){return t(n.component,{key:n.key,tag:"component",attrs:{json:n.json,opts:n.options}})}),e._l(e.scenes,function(n){return n.show?t("Main",{key:n.key,attrs:{json:n.json,opts:n.opts,className:n.className,propsStyle:n.style}}):e._e()}),e._l(e.popups,function(n){return t("Main",{key:n.key,attrs:{json:n.json,opts:n.opts,className:n.className,propsStyle:n.style}})})],2)},_sfc_staticRenderFns$2=[];const __cssModules={$style:style0};function _sfc_injectStyles(o){for(var e in __cssModules)this[e]=__cssModules[e]}var __component__$2=normalizeComponent(_sfc_main$2,_sfc_render$2,_sfc_staticRenderFns$2,!1,_sfc_injectStyles,null,null,null);const MultiScene=__component__$2.exports;console.log("%c @mybricks/render-web-vue %c@0.0.1","color:#FFF;background:#fa6400","","");class Context{constructor(){Pe(this,"_refsMap",{})}setRefs(e,t){this._refsMap[e]=t}getRefsMap(){return this._refsMap}}const _sfc_main$1={functional:!0,render(o,{props:e}){const{json:t,opts:n}=e;if(!t)return null;n.env._context||(n.env._context=new Context);const s=Array.isArray(t.scenes),c=s?MultiScene:Main;return!s&&t.type==="module"&&(e.root=!1),o(c,{props:e},[])}},_sfc_render$1=null,_sfc_staticRenderFns$1=null;var __component__$1=normalizeComponent(_sfc_main$1,_sfc_render$1,_sfc_staticRenderFns$1,!1,null,null,null,null);const Render=__component__$1.exports,_sfc_main={components:{Render},props:{json:{type:Object},opts:{type:Object}}};var _sfc_render=function o(){var e=this,t=e._self._c;return t("Render",e._b({},"Render",this.$props,!1))},_sfc_staticRenderFns=[],__component__=normalizeComponent(_sfc_main,_sfc_render,_sfc_staticRenderFns,!1,null,null,null,null);const App=__component__.exports;function render$1(o,e){return Vue.extend({render:t=>t(App,{props:{json:o,opts:e}})})}window["mybricks-render-vue2"]=function o({json:e,opts:t},n){new Vue({render:s=>s(App,{props:{json:e,opts:t}},[])}).$mount(n)},exports.render=render$1,Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})});
