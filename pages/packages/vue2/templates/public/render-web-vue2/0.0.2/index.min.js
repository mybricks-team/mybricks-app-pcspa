(function(o,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],t):(o=typeof globalThis<"u"?globalThis:o||self,t(o._mybricks_render_web_vue2={},o.Vue))})(this,function(exports,Vue){"use strict";var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var comlibCore={exports:{}};(function(module,exports){(function(o,t){module.exports=t()})(commonjsGlobal,()=>(()=>{var __webpack_modules__={356:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function __WEBPACK_DEFAULT_EXPORT__({data,outputs,inputs,onError}){inputs.from((val,relOutpus)=>{var _a;const script=(_a=data.exchange)===null||_a===void 0?void 0:_a.script;if(script){let fn,returnVal,isOk;try{eval(`fn = ${script}`),returnVal=fn(val),isOk=!0}catch(o){console.error(o),onError(`数据转换错误:${o.message}`,o)}isOk&&outputs.to(returnVal)}else onError("未配置转换规则")})}__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__})}},__webpack_module_cache__={};function __webpack_require__(o){var t=__webpack_module_cache__[o];if(t!==void 0)return t.exports;var e=__webpack_module_cache__[o]={exports:{}};return __webpack_modules__[o](e,e.exports,__webpack_require__),e.exports}__webpack_require__.d=(o,t)=>{for(var e in t)__webpack_require__.o(t,e)&&!__webpack_require__.o(o,e)&&Object.defineProperty(o,e,{enumerable:!0,get:t[e]})},__webpack_require__.o=(o,t)=>Object.prototype.hasOwnProperty.call(o,t),__webpack_require__.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>w,getCom:()=>m});const o=JSON.parse('{"title":"Fn计算","namespace":"mybricks.core-comlib.fn","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"Fn计算","icon":"./icon.png","runtime":"./Fn.tsx","rtType":"js","visibility":false}'),t=JSON.parse('{"visibility":false,"title":"变量","namespace":"mybricks.core-comlib.var","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"变量","icon":"./icon.png","data":"./data.json","runtime":"./Var.tsx","editors":"./editors.tsx","rtType":"js","inputs":[{"id":"get","title":"读取","schema":{"type":"any"},"rels":["return"]},{"id":"set","title":"赋值","schema":{"type":"follow"},"rels":["return"]},{"id":"reset","title":"重置","schema":{"type":"any"}}],"outputs":[{"id":"return","title":"完成","schema":{"type":"unknown"}},{"id":"changed","title":"当值发生变化","schema":{"type":"unknown"}}]}');function e(c){if(c&&typeof c=="object")try{return c instanceof FormData?c:JSON.parse(JSON.stringify(c))}catch{return c}return c}const n=JSON.parse('{"title":"类型转换","visibility":false,"namespace":"mybricks.core-comlib.type-change","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"类型转换","icon":"./icon.png","runtime":"./rt.tsx","editors":"./editors.tsx","rtType":"js","inputs":[{"id":"from","title":"从","schema":{"type":"follow"},"rels":["to"]}],"outputs":[{"id":"to","title":"到","schema":{"type":"follow"},"conMax":1,"editable":true}]}');var s=__webpack_require__(356);const l=JSON.parse('{"deprecated":true,"visibility":false,"title":"连接器","namespace":"mybricks.core-comlib.connector","author":"MyBricks","author_name":"MyBricks","version":"1.0.0","description":"连接器","runtime":"./runtime.ts","editors":"./editors.tsx","icon":"./icon.svg","rtType":"js-autorun","inputs":[{"id":"call","rels":["then","catch"],"title":"调用","schema":{"type":"object"}}],"outputs":[{"id":"then","title":"结果","schema":{"type":"unknown"}},{"id":"catch","title":"发生错误","schema":{"type":"string"}}]}');function i({env:c,data:p,outputs:b,onError:C},f={}){if(p.connector)try{c.callConnector(p.connector,f,p.connectorConfig).then(g=>{b.then(g)}).catch(g=>{b.catch(g)})}catch(g){console.error(g),b.catch(`执行错误 ${g.message||g}`)}else b.catch("没有选择接口")}const u=JSON.parse('{"visibility":false,"title":"作用域输入","namespace":"mybricks.core-comlib.frame-input","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"作用域输入","rtType":"js","runtime":"./runtime.ts","editors":"./editor.tsx","inputs":[{"id":"getCurValue","title":"获取","schema":{"type":"any"},"rels":["return"]}],"outputs":[{"id":"return","title":"结果","schema":{"type":"follow"}}]}'),x=JSON.parse('{"visibility":false,"title":"打开对话框","namespace":"mybricks.core-comlib.scenes","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"切换场景","icon":"./icon.png","runtime":"./runtime.ts","data":"./data.json","rtType":"js","inputs":[{"id":"open","title":"打开","schema":{"type":"any"}}]}'),r=JSON.parse('{"title":"自定义组件","namespace":"mybricks.core-comlib.defined-com","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"自定义组件","icon":"./icon.png","data":"./data.json","runtime":"./runtime.ts","editors":"./editors.ts"}'),j={id:"mybricks-core-comlib",title:"Mybrics核心组件库",author:"CheMingjun",icon:"",version:"1.0.1",comAray:[O({comDef:o,rt:function({inputs:c,outputs:p}){}}),O({comDef:t,rt:function({env:c,data:p,outputs:b,inputs:C,_notifyBindings:f}){C.get((g,F)=>{const M=e(p.val!==void 0?p.val:p.initValue);F.return(M)}),C.set((g,F)=>{p.val=g;const M=e(g);b.changed(M,!0),f(M),F.return(M)}),C.reset(()=>{const g=p.initValue;p.val=g;const F=e(g);b.changed(F,!0),f(F)})}}),O({comDef:n,rt:s.Z}),O({comDef:l,rt:function({env:c,data:p,inputs:b,outputs:C,onError:f}){c.runtime&&(p.immediate?i({env:c,data:p,outputs:C}):b.call(g=>{i({env:c,data:p,outputs:C,onError:f},g)}))}}),O({comDef:u,rt:function({env:c,data:p,inputs:b,outputs:C}){c.runtime&&b.getCurValue((f,g)=>{g.return(f)})}}),O({comDef:x,rt:function({env:c,data:p,inputs:b,_inputs:C,_inputsCallable:f}){b.open(g=>{c.canvas.open(p._sceneId,g,p._sceneShowType==="popup"?null:p.openType),f._open(g)})}}),O({comDef:r,rt:function({env:c,data:p,inputs:b,outputs:C}){const{toJSON:f}=p;return c.renderCom(f,{ref(g){if(c.runtime){const{inputs:F,outputs:M}=f;F.forEach(({id:V})=>{b[V](lt=>{g.inputs[V](lt)})}),M.forEach(({id:V})=>{g.outputs(V,C[V])})}g.run()},disableAutoRun:!0})}})]},w=j;function m(c){return j.comAray.find(p=>p.namespace===c)}function O({comDef:c,rt:p,data:b}){return Object.assign(c,{runtime:p,data:b})}})(),__webpack_exports__})())})(comlibCore);var comlibCoreExports=comlibCore.exports;const coreLib=getDefaultExportFromCjs(comlibCoreExports),globalKey="__IOEventList__",ioLogger={log:(...o)=>{window[globalKey]||(window[globalKey]=[]),window[globalKey].push(o[0]),console.log(...o)}};function log(o){console.log(`%c[Mybricks]%c ${o}
`,"color:#FFF;background:#fa6400","","")}function logInputVal(o,t,e,n){let s;try{s=JSON.stringify(n)}catch{s=n}ioLogger.log(`%c[Mybricks] 输入项 %c ${o||t.title||t.namespace} | ${e} -> ${s}`,"color:#FFF;background:#000","","")}function logOutputVal(o,t,e,n){let s;try{s=JSON.stringify(n)}catch{s=n}ioLogger.log(`%c[Mybricks] 输出项 %c ${o||t.title||t.namespace} | ${e} -> ${s}`,"color:#FFF;background:#fa6400","","")}function isNumber(o){return typeof o=="number"&&!isNaN(o)}function uuid$1(o=5,t=8){const e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=[];if(t=t||e.length,o)for(let s=0;s<o;s++)n[s]=e[0|Math.random()*t];else{let s;n[8]=n[13]=n[18]=n[23]="-",n[14]="4";for(let l=0;l<36;l++)n[l]||(s=0|Math.random()*16,n[l]=e[l==19?s&3|8:s])}return n.join("")}function convertCamelToHyphen(o){return o.replace(/([A-Z])/g,"-$1").toLowerCase()}const toFixed=function o(t,e){var n=Math.pow(10,e+1),s=Math.floor(t*n);return Math.round(s/10)*10/n},createPxReplacer=function o(t,e,n,s){return function(l,i){var u=parseFloat(i);return!i||u<=e?l:"".concat(toFixed(u/t,n)).concat(s)}},remReplace=createPxReplacer(12,0,5,"rem"),vwReplace=createPxReplacer(3.75,0,5,"vw"),REG_PX=/"[^"]+"|'[^']+'|url\([^)]+\)|(\d*\.?\d+)px/g,pxToRem=o=>o.replace(REG_PX,remReplace),pxToVw=o=>o.replace(REG_PX,vwReplace);function dataSlim(o){return o}const ROOT_FRAME_KEY="_rootFrame_";function executor(o,{observable:t}){const{json:e,getComDef:n,env:s,ref:l,onError:i,logger:u,debug:x,debugLogger:r,scenesOperate:j}=o,{slot:w,coms:m={},comsAutoRun:O={},cons:c=[],pinRels:p={},pinProxies:b={},pinValueProxies:C={}}=e,f=s,g={},F={},M={},V={},lt={};Object.keys(c).forEach(y=>{const _=c[y],{startPinParentKey:d}=_[0];d&&(lt[d]=y)});const ot={},Z={};function at(y,_){if(y==="com"){const{com:d,pinHostId:$,val:h,fromCon:E,notifyAll:a,comDef:S}=_;r?r("com","output",{id:d.id,pinHostId:$,val:h,fromCon:E,notifyAll:a,comDef:S}):logOutputVal(d.title,S,$,h)}else if(y==="frame"){const{comId:d,frameId:$,pinHostId:h,val:E,sceneId:a}=_;r&&r("frame","output",{comId:d,frameId:$,pinHostId:h,val:E,sceneId:a})}}function ut(y){const{com:_,pinHostId:d,val:$,frameKey:h,finishPinParentKey:E,comDef:a}=y;r?r("com","input",{id:_.id,pinHostId:d,val:$,frameKey:h,finishPinParentKey:E,comDef:a}):logInputVal(_.title,a,d,$)}function st(y,_,d,$,h){function E(a,S){var P,T;const v=b[a.comId+"-"+a.pinId];if(v){if(Z[`${v.frameId}-${v.pinId}`]=_,$&&$.finishPinParentKey!==a.startPinParentKey)return;if(v.type==="frame"){const I=rt(a.comId,S);let k;k={id:uuid$1(10,16),frameId:v.frameId,parent:S,proxyComProps:I};const z=a.def.namespace==="mybricks.core-comlib.frame-output";z&&S&&(v.frameId=S.proxyComProps.id,k=S.parent),H(v,_,k),z||J({frameId:v.frameId,scope:k});return}}if(a.type==="com")$?$.finishPinParentKey===a.startPinParentKey&&dt(a,_,S):dt(a,_,S);else if(a.type==="frame"){if($&&$.finishPinParentKey!==a.startPinParentKey)return;if(a.comId){if(a.direction==="inner-input"){const I=F[a.comId+"-"+a.frameId+"-"+((P=S==null?void 0:S.parent)!=null&&P.id?S.parent.id+"-":"")+a.pinId];I&&I(_)}else if(a.direction==="inner-output"&&a.pinType==="joint"){const I=c[a.comId+"-"+a.frameId+"-"+a.pinId];I&&st(I,_)}}else{const I=S==null?void 0:S.proxyComProps;if(I){const k=I.outputs[a.pinId];if(k){k(_,S.parent);return}}(T=V[a.pinId])==null||T.call(V,_)}}else throw new Error("尚未实现")}y.forEach(a=>{if(x&&a.isIgnored)return;let S=d;if(h){const v=a.frameKey;if(!v)throw new Error("数据异常，请检查toJSON结果.");if(v===ROOT_FRAME_KEY)E(a,{});else{const P=v.split("-");if(P.length>=2){const T=_t(P[0],P[1],null,h);T.curScope?(T.curScope!==S&&(S=T.curScope),E(a,S)):T.pushTodo(I=>{I!==S&&(S=I),E(a,S)})}}}else{const v=a.frameKey.split("-");if(v.length>=2&&!S){const P=_t(v[0],v[1],null,!1);if((P==null?void 0:P.type)==="scope"&&!(P!=null&&P.curScope)){P.pushTodo(T=>{T!==S&&(S=T),E(a,S)});return}}E(a,S)}})}function rt(y,_){var Et;const d=m[y];if(!d)return null;const $=y+(d.frameId||ROOT_FRAME_KEY);let h=g[$];h||(h=g[$]={});let E,a=_;for(!a&&d.parentComId&&d.frameId&&(a=(Et=g[`${d.parentComId}-${d.frameId}`])==null?void 0:Et.curScope);a;){const B=a.id+"-"+y;if(a.frameId===d.frameId){E=a.id;const R=h[B];if(R)return R;{const A=a.parentComId;if(A){if(A===d.paramId||A===d.parentComId)break}else break}}a=a.parent}const S=(E?E+"-":"")+y,v=h[S];if(v)return v;const P=d.def,T=d.model,I=JSON.parse(JSON.stringify(T.data)),k=JSON.parse(JSON.stringify(T.style));k.__model_style__=!0;const z={},W={},N={},L=(B,R,A,U)=>{let K=W[B];K||(W[B]=K=[]),K.push({val:R,fromCon:A,fromScope:U})},X=function(B){return new Proxy({},{ownKeys(R){return d.inputs},getOwnPropertyDescriptor(R){return{enumerable:!0,configurable:!0}},get(R,A){return function(U){if(Object.prototype.toString.call(A)==="[object Symbol]")return;const K=B==null?void 0:B.inputs;if(K){const q=K[A];typeof q=="function"&&q(U)}z[A]=U;const Y=W[A];Y&&(Y.forEach(({val:q,fromCon:pt,fromScope:mt})=>{U(q,new Proxy({},{get(gt,St){return function(vt){if(Object.prototype.toString.call(St)==="[object Symbol]")return;const ht=ct()[St];if(typeof ht=="function")ht(vt,mt||a,pt);else throw new Error(`outputs.${St} not found`)}}}))}),W[A]=void 0)}}})},Q=new Proxy({},{get(B,R){return function(A){if(Object.prototype.toString.call(R)==="[object Symbol]")return;const U=p[y+"-"+R];if(U){const K={},Y={};return U.forEach(q=>{K[q]=pt=>{Y[q]=pt}}),Promise.resolve().then(()=>{dt({comId:y,def:P,pinId:R},A,_,Y)}),K}else dt({comId:y,def:P,pinId:R},A,_)}}}),it=new Proxy({},{get(B,R){return function(A){if(Object.prototype.toString.call(R)==="[object Symbol]")return;const U=b[y+"-"+R];U&&(j==null||j.inputs({...U,value:A,parentScope:ft}))}}}),ct=function(B){return new Proxy({},{ownKeys(R){return d.outputs},getOwnPropertyDescriptor(R){return{enumerable:!0,configurable:!0}},get(R,A,U){const K=function(Y,q,pt,mt){if(Object.prototype.toString.call(A)==="[object Symbol]")return;const gt=typeof q=="boolean"&&q;if(d.global&&gt&&!mt){j==null||j.exeGlobalCom({com:d,value:Y,pinId:A});return}const St=arguments,vt=B==null?void 0:B.outputs;if(vt){const bt=vt[A];typeof bt=="function"&&bt(Y)}let ht;q&&typeof q=="object"&&(ht=q);const Tt=n(P);at("com",{com:d,pinHostId:A,val:Y,fromCon:pt,notifyAll:gt,comDef:Tt});const Ft=T.outputEvents;let nt;if(Ft){const bt=Ft[A];if(bt&&Array.isArray(bt)){const It=bt.find($t=>$t.active);if(It){const{type:$t}=It;switch($t){case"none":nt=[];break;case"fx":const Ct=b[y+"-"+A];if((Ct==null?void 0:Ct.type)==="frame"){const xt=`${Ct.frameId}-${Ct.pinId}`;nt=c[xt]||[],Z[xt]=Y}else nt=[];break;case"defined":break;default:if(nt=[],Array.isArray(s==null?void 0:s.events)){const xt=s.events.find(Pt=>{if(Pt.type===$t)return Pt});xt&&typeof xt.exe=="function"&&xt.exe({options:It.options})}break}}}}nt=nt||c[y+"-"+A],nt!=null&&nt.length&&(St.length>=3?st(nt,Y,ht,pt):st(nt,Y,ht||_,pt,gt))};return K.getConnections=()=>c[y+"-"+A]||[],K}})},et=new Proxy({},{get(B,R,A){return function(U){if(Object.prototype.toString.call(R)==="[object Symbol]")return;const K=N[R];K&&(K.forEach(Y=>{U(Y)}),N[R]=void 0)}}}),Ot=new Proxy({},{get(B,R,A){return function(U){if(Object.prototype.toString.call(R)==="[object Symbol]")return;const K=c[y+"-"+R];K&&(at("com",{com:d,pinHostId:R,val:U,comDef:P}),st(K,U,_))}}});function yt(B){if(d.global){j==null||j._notifyBindings(B,d);return}const{bindingsTo:R}=d.model;if(R)for(let A in R){const U=rt(A);if(U){const K=R[A];Array.isArray(K)&&K.forEach(Y=>{let q=U;const pt=Y.split(".");pt.forEach((mt,gt)=>{gt!==pt.length-1?q=q[mt]:q[mt]=B})})}}}const ft={id:d.id,title:d.title,frameId:d.frameId,parentComId:d.parentComId,data:t(I),style:t(k),_inputRegs:z,addInputTodo:L,inputs:X(),inputsCallable:Q,_inputsCallable:it,outputs:ct(),_inputs:et,_outputs:Ot,clone(B){const R={inputs:X(B),outputs:ct(B)};return Object.setPrototypeOf(R,this),R},_notifyBindings:yt,logger:u,onError:x?B=>i({comId:y,error:B}):i};return h[S]=ft,ft}function wt(y,_){let d=Z[`${y}${_?`-${_.id}-${_.frameId}`:""}`];return typeof d>"u"&&(_!=null&&_.parent)&&(d=wt(y,_.parent)),d}function dt(y,_,d,$){var T;const{comId:h,def:E,pinId:a,pinType:S,frameKey:v,finishPinParentKey:P}=y;if(S==="ext"){const I=g[h]||rt(h,d);if(a==="show")I.style.display="";else if(a==="hide")I.style.display="none";else if(a==="showOrHide"){const z=I.style;typeof _>"u"?z.display==="none"?z.display="":z.display="none":z.display=_?"":"none"}const k=n(E);ut({com:I,val:_,pinHostId:a,frameKey:v,finishPinParentKey:P,comDef:k})}else if(S==="config"){const I=rt(h,d),k=n(E);ut({com:I,pinHostId:a,val:_,frameKey:v,finishPinParentKey:P,comDef:k});const{extBinding:z}=y,W=z.split(".");let N=I;W.forEach((L,X)=>{X!==W.length-1?N=N[L]:N[L]=_})}else if((T=E.rtType)!=null&&T.match(/^js/gi)){const I=m[h];if(I){const k=rt(h,d),z=n(E);if(I.global){const et=j==null?void 0:j.getGlobalComProps(h);et&&(k.data=et.data)}const W=d==null?void 0:d.id,N=(W?W+"-":"")+h;ut({com:I,val:_,pinHostId:a,frameKey:v,finishPinParentKey:P,comDef:z}),M[N]||(M[N]=!0,z.runtime({env:f,data:k.data,inputs:k.inputs,outputs:k.outputs,_notifyBindings:k._notifyBindings,_inputsCallable:k._inputsCallable,logger:u,onError:x?et=>i({comId:h,error:et}):i}));const{realId:L,realVal:X,isReady:Q,isMultipleInput:it}=D(y,_,k);typeof k._inputRegs[L]=="function"&&(it&&Q||!it)&&k._inputRegs[L](X,new Proxy({},{get(et,Ot){return function(yt){if(Object.prototype.toString.call(Ot)!=="[object Symbol]"){if(C){const ft=C[`${h}-${a}`];ft&&(yt=wt(`${v}-${ft.pinId}`,d),typeof yt>"u"&&(yt=wt(`${v}-${ft.pinId}`,null)))}k.outputs[Ot](yt,d,y)}}}}))}}else{const I=rt(h,d);if(!I)return;const k=n(E);ut({com:I,pinHostId:a,val:_,frameKey:v,finishPinParentKey:P,comDef:k});const{realId:z,realVal:W,isReady:N,isMultipleInput:L}=D(y,_,I),X=I._inputRegs[z];if(L&&N||!L)if(typeof X=="function"){let Q;$?Q=$:Q=new Proxy({},{get(it,ct){return function(et){Object.prototype.toString.call(ct)!=="[object Symbol]"&&I.outputs[ct](et,d,y)}}}),X(W,Q)}else I.addInputTodo(z,W,y,d)}if(P){const I=c[lt[P]];I&&!p[`${h}-${a}`]&&st(I,void 0)}}function D(y,_,d){const{pinId:$,comId:h}=y,E=$.indexOf(".");if(E!==-1){let a=$.substring(0,E);const S=$.substring(E+1);let v=ot[h];v||(v=ot[h]={}),v[S]=_;const P=new RegExp(`${a}.`),T=Object.keys(d.inputs).filter(I=>!!I.match(P));return Object.keys(v).length===T.length?(delete ot[h],{isMultipleInput:!0,isReady:!0,realId:a,realVal:v}):{isMultipleInput:!0,isReady:!1}}return{isMultipleInput:!1,isReady:!0,realId:$,realVal:_}}function jt(y,_){let d;return y!=null&&y.comAry&&y.comAry.find($=>{if($.id===_)return d=$,$;if($.slots){for(let h in $.slots)if(d=jt($.slots[h],_),d)return d}}),d}function _t(y,_,d,$){let h=y+"-"+_+(d?`-${d.id}`:""),E=g[h];if($&&!E&&(E=g[Object.keys(g).find(a=>a.startsWith(h))]),!E){const a=jt(w,y);if(!(a!=null&&a.slots))return null;const S=a==null?void 0:a.slots[_],v={};let P;if(d){const N=g[y+"-"+_];N&&(P=N.todo)}const T={scope:d,todo:P},I=new Proxy({},{get(N,L){return function(X){Object.prototype.toString.call(L)!=="[object Symbol]"&&(v[L]=X)}}}),k=new Proxy({},{get(N,L){const X=function(Q,it){if(Object.prototype.toString.call(L)==="[object Symbol]")return;const ct=y+"-"+_+"-"+L,et=c[ct];Z[`${ct}${it?`-${it.id}-${it.frameId}`:""}`]=Q,at("frame",{comId:y,frameId:_,pinHostId:L,val:Q}),et&&st(et,Q,it||T.scope)};return X.getConnections=()=>c[y+"-"+_+"-"+L]||[],X}}),z=new Proxy({},{get(N,L,X){return function(Q){Object.prototype.toString.call(L)!=="[object Symbol]"&&(F[h+"-"+L]=Q)}}});let W={};E=g[h]={type:S==null?void 0:S.type,run(N){T.scope=N;const L=(N==null?void 0:N.id)||"none";W[L]||(W[L]=!0,J({comId:y,frameId:_,scope:N})),Array.isArray(T.todo)&&(T.todo.forEach(X=>{Promise.resolve().then(()=>{X(N)})}),T.todo=void 0)},destroy(){Reflect.deleteProperty(g,h)},_inputs:I,_inputRegs:v,inputs:k,outputs:z,get curScope(){return T.scope},get todo(){return T.todo},pushTodo(N){T.todo||(T.todo=[]),T.todo.push(N)}}}return E}function J(y){const{comId:_,frameId:d,scope:$}=y,h=_?`${_}-${d}`:`${d}`,E=O[h];E&&E.forEach(a=>{const{id:S,def:v}=a;if(m[S]){const T=rt(S,$),I=n(v);log(`${I.namespace} 开始执行`),I.runtime({env:f,data:T.data,inputs:T.inputs,outputs:T.outputs,_inputsCallable:T._inputsCallable,logger:u,onError:x?k=>i({comId:S,error:k}):i})}})}function H(y,_,d=void 0,$=!0){const{frameId:h,comId:E,pinId:a,sceneId:S}=y,v=E?`${E}-${h}`:`${h}`,P=c[v+"-"+a];Z[`${h}-${a}`]=_,$&&at("frame",{comId:E,frameId:h,pinHostId:a,val:_,sceneId:S}),P?st(P,_,d):h!==ROOT_FRAME_KEY&&(e.id===h?V[a](_):j==null||j.open({frameId:h,todo:{pinId:a,value:_},parentScope:d.proxyComProps}))}const G={get(y,_,d,$){let h,E,a;for(let S=0;S<arguments.length;S++){const v=arguments[S];S>0&&typeof v=="string"&&(h=v),typeof v=="object"&&(v.inputs||v.outputs||v._inputs||v._outputs?a=v:(v.id||v.parent)&&(E=v))}if(h)return _t(y,h,E);{const S=rt(y,E);return a?S.clone(a):S}},getComInfo(y){return m[y]}};return typeof l=="function"&&l({run(){J({frameId:ROOT_FRAME_KEY})},inputs:new Proxy({},{get(y,_){return function(d,$=void 0,h=!0){Object.prototype.toString.call(_)!=="[object Symbol]"&&H({frameId:ROOT_FRAME_KEY,pinId:_,sceneId:$},d,void 0,h)}}}),outputs(y,_){V[y]=_},get:G.get,getComInfo:G.getComInfo}),G}function normalizeComponent(o,t,e,n,s,l,i,u){var x=typeof o=="function"?o.options:o;t&&(x.render=t,x.staticRenderFns=e,x._compiled=!0),n&&(x.functional=!0),l&&(x._scopeId="data-v-"+l);var r;if(i?(r=function(m){m=m||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!m&&typeof __VUE_SSR_CONTEXT__<"u"&&(m=__VUE_SSR_CONTEXT__),s&&s.call(this,m),m&&m._registeredComponents&&m._registeredComponents.add(i)},x._ssrRegister=r):s&&(r=u?function(){s.call(this,(x.functional?this.parent:this).$root.$options.shadowRoot)}:s),r)if(x.functional){x._injectStyles=r;var j=x.render;x.render=function(O,c){return r.call(c),j(O,c)}}else{var w=x.beforeCreate;x.beforeCreate=w?[].concat(w,r):[r]}return{exports:o,options:x}}const _sfc_main$6={props:{slotId:{type:String},propsSlot:{type:Object},params:{type:Object},props:{type:Object},propsStyle:{type:Object},onError:{type:Function},logger:{type:Object},env:{type:Object},_env:{type:Object},scope:{type:Object},getComDef:{type:Function},context:{type:Object}},created(){let o;const{propsSlot:t,scope:e,props:n,env:s,_env:l,getComDef:i,registSpm:u,context:x,onError:r,logger:j,params:w}=this.$props;if(Object.assign(w,w.m),(t==null?void 0:t.type)==="scope"?(o={id:uuid(10,16),frameId:slotId},e&&(o.parent=e)):o=e,w){const m=w.inputValues;if(typeof m=="object")for(let O in m)n.inputs[O](m[O],o);typeof w.wrap=="function"&&w.wrap}n.run(o),this.slotProps={scope:o,env:s,_env:l,propsSlot:t,params:w,getComDef:i,registSpm:u,context:x,inputs:w==null?void 0:w.inputs,outputs:w==null?void 0:w.outputs,_inputs:w==null?void 0:w._inputs,_outputs:w==null?void 0:w._outputs,onError:r,logger:j},this.slotComponent=RenderSlot}};var _sfc_render$6=function o(){var t=this,e=t._self._c;return e(t.slotComponent,t._b({tag:"component"},"component",t.slotProps,!1))},_sfc_staticRenderFns$6=[],__component__$6=normalizeComponent(_sfc_main$6,_sfc_render$6,_sfc_staticRenderFns$6,!1,null,null,null,null);const SlotRender=__component__$6.exports,com="_com_z9da4_2",flex="_flex_z9da4_7",style0$2={com,flex},_sfc_main$5={props:{com:{type:Object},getComDef:{type:Function},registSpm:{type:Function},context:{type:Object},scope:{type:Object},props:{type:Object},env:{type:Object},_env:{type:Object},onError:{type:Function},logger:{type:Object}},components:{SlotRender},created(){var _t;const{_env:o,env:t,com:e,props:n,getComDef:s,registSpm:l,onError:i,logger:u,context:x,scope:r}=this.$props,{pxToRem:j,pxToVw:w}=t,{id:m,def:O,name:c,slots:p={}}=e,{data:b,title:C,style:f,inputs:g,outputs:F,_inputs:M,_outputs:V,_notifyBindings:lt}=n,ot=this.getStyleAry({env:t,def:O,style:f});if(Array.isArray(ot)){const J=(t==null?void 0:t.shadowRoot)||((_t=document.getElementById("_mybricks-geo-webview_"))==null?void 0:_t.shadowRoot);if(!(J||document).querySelector(`style[id="${m}"]`)){const H=document.createElement("style");let G="";H.id=m,ot.forEach(({css:y,selector:_,global:d})=>{_===":root"&&(_="> *:first-child"),G=G+`
            ${d?"":`#${m} `}${_.replace(/\{id\}/g,`${m}`)} {
              ${Object.keys(y).map($=>{let h=y[$];return j&&typeof h=="string"&&h.indexOf("px")!==-1?h=pxToRem(h):w&&typeof h=="string"&&h.indexOf("px")!==-1&&(h=pxToVw(h)),`${convertCamelToHyphen($)}: ${h};`}).join(`
`)}
            }
          `}),H.innerHTML=G,J?J.appendChild(H):document.head.appendChild(H)}}Reflect.deleteProperty(f,"styleAry"),Reflect.deleteProperty(f,"themesId");const Z=s(O),at=[],ut={};e.slots&&Object.entries(e.slots).forEach(([J,H])=>{const G=x.get(m,J,r);ut[J]={get size(){var y;return((y=H==null?void 0:H.comAry)==null?void 0:y.length)||0}},at.push({slotId:J,propsSlot:H,props:G,propsStyle:f,onError:i,logger:u,env:t,_env:o,scope:r,getComDef:s,context:x})}),this.templateSlots=at;let st;if(n.frameId&&n.parentComId){const J=x.get(n.parentComId,n.frameId,r==null?void 0:r.parent);J&&(st={get _inputs(){return new Proxy({},{get(H,G){return J._inputRegs[G]}})}})}const rt=this.getClasses({style:f,id:m}),wt=this.getSizeStyle({style:f,env:t}),dt=this.getMarginStyle({style:f,env:t}),D={};if(["fixed","absolute"].includes(f.position)){const{top:J,left:H,right:G,bottom:y}=f;(J||isNumber(J))&&(D.top=isNumber(J)?J+"px":J),(y||isNumber(y))&&(D.bottom=isNumber(y)?y+"px":y),(H||isNumber(H))&&(D.left=isNumber(H)?H+"px":H),(G||isNumber(G))&&(D.right=isNumber(G)?G+"px":G),f.position==="fixed"&&(D.zIndex=1e3);const{pxToVw:_}=t;_&&(typeof D.top=="string"&&D.top.indexOf("px")!==-1&&(D.top=pxToVw(D.top)),typeof D.bottom=="string"&&D.bottom.indexOf("px")!==-1&&(D.bottom=pxToVw(D.bottom)),typeof D.left=="string"&&D.left.indexOf("px")!==-1&&(D.left=pxToVw(D.left)),typeof D.right=="string"&&D.right.indexOf("px")!==-1&&(D.right=pxToVw(D.right)))}this.component=Z.runtime,this.comDef=Z,this.containerProps={id:m,key:m,style:{display:f.display,position:f.position||"relative",...D,...wt,...dt,...f.ext||{}}},this.containerClass=rt;const jt={id:m,env:{...t,pxToVw,spm:l?l==null?void 0:l(m,{title:C,namespace:O.namespace}):null},_env:o,data:b,name:c,title:C,slots:ut,propsStyle:f,inputs:g,outputs:F,_inputs:M,_outputs:V,_notifyBindings:lt,parentSlot:st,onError:i,logger:u};this.componentProps={...jt,m:{...jt,style:f}}},methods:{getStyleAry({env:o,def:t,style:e}){var u;const n=(u=o==null?void 0:o.themes)==null?void 0:u.comThemes;if(!n)return e.styleAry;let s;const{themesId:l}=e,{namespace:i}=t;if(l)if(l==="_defined")s=e.styleAry;else{const x=n[i];if(Array.isArray(x)){const r=x.find(({id:j})=>j===l);r&&(s=r.styleAry)}}else{const x=n[i];if(Array.isArray(x)){const r=x.find(({isDefault:j})=>j);r&&(s=r.styleAry)}}return s||e.styleAry},getClasses({style:o,id:t}){const e=[t,this.$style.com];return o.flex===1&&e.push(this.$style.flex),e.join(" ")},getSizeStyle({style:o,env:t}){const e={},{width:n,height:s}=o;n?isNumber(n)?e.width=n+"px":n&&(e.width=n):e.width="100%",isNumber(s)?e.height=s+"px":s&&(e.height=s);const{pxToVw:l}=t;return l&&(typeof e.width=="string"&&e.width.indexOf("px")!==-1&&(e.width=pxToVw(e.width)),typeof e.height=="string"&&e.height.indexOf("px")!==-1&&(e.height=pxToVw(e.height))),e},getMarginStyle({style:o,env:t}){const e={},{width:n,marginTop:s,marginLeft:l,marginRight:i,marginBottom:u}=o;isNumber(s)&&(e.marginTop=s+"px"),isNumber(l)&&(typeof n=="number"||l<0?e.marginLeft=l+"px":e.paddingLeft=l+"px"),isNumber(i)&&(typeof n=="number"||i<0?e.marginRight=i+"px":e.paddingRight=i+"px"),isNumber(u)&&(e.marginBottom=u+"px");const{pxToVw:x}=t;return x&&(typeof e.marginTop=="string"&&e.marginTop.indexOf("px")!==-1&&(e.marginTop=pxToVw(e.marginTop)),typeof e.marginLeft=="string"&&e.marginLeft.indexOf("px")!==-1&&(e.marginLeft=pxToVw(e.marginLeft)),typeof e.marginRight=="string"&&e.marginRight.indexOf("px")!==-1&&(e.marginRight=pxToVw(e.marginRight)),typeof e.marginBottom=="string"&&e.marginBottom.indexOf("px")!==-1&&(e.marginBottom=pxToVw(e.marginBottom)),typeof e.paddingLeft=="string"&&e.paddingLeft.indexOf("px")!==-1&&(e.paddingLeft=pxToVw(e.paddingLeft)),typeof e.paddingRight=="string"&&e.paddingRight.indexOf("px")!==-1&&(e.paddingRight=pxToVw(e.paddingRight))),e},getSlotProps(){}}};var _sfc_render$5=function o(){var t=this,e=t._self._c;return e("div",t._b({class:t.containerClass},"div",t.containerProps,!1),[e(t.component,t._b({tag:"component",scopedSlots:t._u([t._l(t.templateSlots,function(n){return{key:n.slotId,fn:function(s){return[e("SlotRender",t._b({},"SlotRender",{...n,params:s},!1))]}}})],null,!0)},"component",t.componentProps,!1))],1)},_sfc_staticRenderFns$5=[];const __cssModules$2={$style:style0$2};function _sfc_injectStyles$2(o){for(var t in __cssModules$2)this[t]=__cssModules$2[t]}var __component__$5=normalizeComponent(_sfc_main$5,_sfc_render$5,_sfc_staticRenderFns$5,!1,_sfc_injectStyles$2,null,null,null);const RenderCom=__component__$5.exports,slot="_slot_rwhgo_1",lyFlexColumn="_lyFlexColumn_rwhgo_6",lyFlexRow="_lyFlexRow_rwhgo_10",justifyContentFlexStart="_justifyContentFlexStart_rwhgo_14",justifyContentFlexCenter="_justifyContentFlexCenter_rwhgo_17",justifyContentFlexFlexEnd="_justifyContentFlexFlexEnd_rwhgo_20",justifyContentFlexSpaceAround="_justifyContentFlexSpaceAround_rwhgo_23",justifyContentFlexSpaceBetween="_justifyContentFlexSpaceBetween_rwhgo_26",alignItemsFlexStart="_alignItemsFlexStart_rwhgo_29",alignItemsFlexCenter="_alignItemsFlexCenter_rwhgo_32",alignItemsFlexFlexEnd="_alignItemsFlexFlexEnd_rwhgo_35",debugFocus="_debugFocus_rwhgo_38",error="_error_rwhgo_42",errorRT="_errorRT_rwhgo_47",tt="_tt_rwhgo_51",info="_info_rwhgo_57",style0$1={slot,lyFlexColumn,lyFlexRow,justifyContentFlexStart,justifyContentFlexCenter,justifyContentFlexFlexEnd,justifyContentFlexSpaceAround,justifyContentFlexSpaceBetween,alignItemsFlexStart,alignItemsFlexCenter,alignItemsFlexFlexEnd,debugFocus,error,errorRT,tt,info},_sfc_main$4={props:{env:{type:Object},propsStyle:{type:Object},_env:{type:Object},propsSlot:{type:Object},getComDef:{type:Function},registSpm:{type:Function},context:{type:Object},className:{type:String},onError:{type:Function},logger:{type:Object},root:{type:Boolean},scope:{type:Object},inputs:{type:Object},outputs:{type:Object},_inputs:{type:Object},_outputs:{type:Object},params:{type:Object}},created(){},computed:{comAry(){const{env:o,_env:t,propsSlot:e,context:n,getComDef:s,registSpm:l,onError:i,logger:u,scope:x,inputs:r,_inputs:j,outputs:w,_outputs:m}=this.$props,{comAry:O}=e,c=[];return O.forEach((p,b)=>{var ot;const{id:C,def:f,name:g}=p,F=n.getComInfo(C),{hasPermission:M}=o,V=(ot=F==null?void 0:F.model)==null?void 0:ot.permissions;if(V&&typeof M=="function"&&!M(V.id))return;if(s(f)){const Z=n.get(C,x,{inputs:r,outputs:w,_inputs:j,_outputs:m}),at=(x?x.id:"")+b;c.push({id:C,props:{key:at,com:p,getComDef:s,registSpm:l,context:n,scope:x,props:Z,env:o,_env:t,onError:i,logger:u},component:RenderCom,name:g,inputs:Z.inputsCallable,style:Z.style})}else console.error(`组件 (namespace = {${f.namespace}}）未找到.`)}),c},classes(){const{root:o,className:t,params:e,propsStyle:n}=this.$props,l=(e==null?void 0:e.style)||(e==null?void 0:e._style)||n;return`${this.calSlotClasses(l||{})}${o&&t?` ${t}`:""}`},styles(){const{root:o,propsStyle:t,params:e}=this.$props,n=(e==null?void 0:e.style)||(e==null?void 0:e._style),s=n||t;return{...this.calSlotStyles(s||{},!!n,o),...t}}},methods:{calSlotStyles(o,t,e){const{paddingLeft:n,paddingTop:s,paddingRight:l,paddingBottom:i,background:u,backgroundColor:x,backgroundImage:r,backgroundPosition:j,backgroundRepeat:w,backgroundSize:m,...O}=o;let c={paddingLeft:n||0,paddingTop:s||0,paddingRight:l||0,paddingBottom:i||0,backgroundColor:x,backgroundImage:r,backgroundPosition:j,backgroundRepeat:w,backgroundSize:m};if(u)if(typeof u=="object"){const{background:b,backgroundImage:C,backgroundColor:f,backgroundRepeat:g,backgroundSize:F}=u;c.backgroundRepeat=g,c.backgroundSize=F,b?c.background=b:(c.backgroundImage=C,c.backgroundColor=f)}else c.background=u;return t&&(c=Object.assign(c,O)),c},calSlotClasses(o){var s,l;const t=this.$style,e=[t.slot,"slot"],n=o;if(n){((s=n.layout)==null?void 0:s.toLowerCase())=="flex-column"?e.push(t.lyFlexColumn):((l=n.layout)==null?void 0:l.toLowerCase())=="flex-row"&&e.push(t.lyFlexRow);const i=n.justifyContent;i&&(i.toUpperCase()==="FLEX-START"?e.push(t.justifyContentFlexStart):i.toUpperCase()==="CENTER"?e.push(t.justifyContentFlexCenter):i.toUpperCase()==="FLEX-END"?e.push(t.justifyContentFlexFlexEnd):i.toUpperCase()==="SPACE-AROUND"?e.push(t.justifyContentFlexSpaceAround):i.toUpperCase()==="SPACE-BETWEEN"&&e.push(t.justifyContentFlexSpaceBetween));const u=n.alignItems;u&&(u.toUpperCase()==="FLEX-START"?e.push(t.alignItemsFlexStart):u.toUpperCase()==="CENTER"?e.push(t.alignItemsFlexCenter):u.toUpperCase()==="FLEX-END"&&e.push(t.alignItemsFlexFlexEnd))}return e.join(" ")}}};var _sfc_render$4=function o(){var t=this,e=t._self._c;return e("div",{class:t.classes,style:t.styles,attrs:{"data-isslot":"1"}},[t._l(t.comAry,function(n){return e(n.component,t._b({key:n.id,tag:"component"},"component",n.props,!1))}),e("div")],2)},_sfc_staticRenderFns$4=[];const __cssModules$1={$style:style0$1};function _sfc_injectStyles$1(o){for(var t in __cssModules$1)this[t]=__cssModules$1[t]}var __component__$4=normalizeComponent(_sfc_main$4,_sfc_render$4,_sfc_staticRenderFns$4,!1,_sfc_injectStyles$1,null,null,null);const RenderSlot=__component__$4.exports,_sfc_main$3={components:{RenderSlot},props:{json:{type:Object},opts:{type:Object},propsStyle:{type:Object},className:{type:String}},created(){const{json:o,opts:t}=this.$props;this.hasUi=o.rtType!=="js";let e={};t.comDefs&&Object.assign(e,t.comDefs);let n=[...window.__comlibs_edit_||[],...window.__comlibs_rt_||[]];n.push(coreLib),n.forEach(s=>{const l=s.comAray;l&&Array.isArray(l)&&this.regAry(l,e)}),this.comDefs=e;try{let s,l=!0;const i=executor({json:o,getComDef:this.getComDef,events:t.events,env:t.env,ref(u){s=u,typeof t.ref=="function"&&(t.ref(u),l=!1)},onError:this.onError,debug:t.debug,debugLogger:t.debugLogger,logger:this.logger,scenesOperate:t.scenesOperate},{observable:t.observable||Vue.observable});this.context=i,this.refs=s,this.activeTriggerInput=l}catch(s){throw console.error(s),new Error("导出的JSON.script执行异常.")}},mounted(){const{opts:o,json:t}=this.$props;if(!o.disableAutoRun){if(this.activeTriggerInput){const{inputs:e}=this.refs,n=t.inputs;e&&Array.isArray(n)&&n.forEach(s=>{const{id:l,mockData:i}=s;let u;if(o.debug&&typeof i<"u")try{u=JSON.parse(decodeURIComponent(i))}catch{u=i}e[l](u)})}refs.run()}},computed:{logger(){return{...console}},onError(){return o=>{console.error(o)}},props(){const{json:o,opts:t,propsStyle:e,className:n}=this.$props;return{env:t.env,propsStyle:e,_env:t._env,registSpm:t.registSpm,propsSlot:o.slot,getComDef:this.getComDef,context:this.context,className:n,onError:this.onError,logger:this.logger,root:!0}}},methods:{regAry(o,t){o.forEach(e=>{e.comAray?this.regAry(e.comAray,t):t[`${e.namespace}-${e.version}`]=e})},getComDef(o){const{comDefs:t}=this,e=t[o.namespace+"-"+o.version];if(!e){const n=[];for(let s in t)s.startsWith(o.namespace+"-")&&n.push(t[s]);if(n&&n.length>0){n.sort((l,i)=>compareVersion(l.version,i.version));const s=n[0];return console.warn(`【Mybricks】组件${o.namespace+"@"+o.version}未找到，使用${s.namespace}@${s.version}代替.`),s}else throw console.log(t),new Error(`组件${o.namespace+"@"+o.version}未找到，请确定是否存在该组件以及对应的版本号.`)}return e}}};var _sfc_render$3=function o(){var t=this,e=t._self._c;return t.hasUi?e("RenderSlot",t._b({},"RenderSlot",t.props,!1)):t._e()},_sfc_staticRenderFns$3=[],__component__$3=normalizeComponent(_sfc_main$3,_sfc_render$3,_sfc_staticRenderFns$3,!1,null,null,null,null);const Main=__component__$3.exports,main="_main_1oukw_14",slipInto="_slipInto_1oukw_1",style0={main,slipInto},_sfc_main$2={components:{Main},props:{json:{type:Object},opts:{type:Object}},data(){return{count:0,popupIds:[],pageScenes:[]}},created(){const{json:o,opts:t}=this.$props;if(t.sceneId){const i=o.scenes.findIndex(u=>u.id===t.sceneId);if(i!==-1){const u=o.scenes.splice(i,1);o.scenes.unshift(...u),u[0].type==="popup"&&this.setPopupIds([u[0].id])}}const e=[];if(o.scenes.forEach((i,u)=>{i.type==="popup"?u||this.setPopupIds([i.id]):e.push(i)}),this.setPageScenes(e),this.scenesMap=o.scenes.reduce((i,u,x)=>{var r;return{...i,[u.id]:{show:x===0,todo:[],json:u,disableAutoRun:!!x,useEntryAnimation:!1,type:((r=u.slot)==null?void 0:r.showType)||u.type}}},{}),this.scenesOperateInputsTodo={},this.themes=o.themes,this.permissions=o.permissions||[],this.globalVarMap={},t.ref){const i=t.ref;t.ref=u=>x=>(u(x),i.call(t,x))}else t.ref=i=>u=>{i(u)};const n={},s=[],{global:l}=o;if(l){const{fxFrames:i}=l;Array.isArray(i)&&i.forEach(u=>{var c;const{id:x}=u,r={};n[x]=r;const j={...t,env:{...t.env,canvas:Object.assign({id:x,type:(window==null?void 0:window.document.body.clientWidth)<=414?"mobile":"pc",open:async(p,b,C)=>{var g;let f=scenesMap[p];if(!f){if(typeof t.scenesLoader!="function"){console.error(`缺少场景信息: ${p}`);return}const F=await t.scenesLoader({id:p});if(f={disableAutoRun:!1,json:F,show:!1,parentScope:null,todo:[],type:((g=F.slot)==null?void 0:g.showType)||F.type,useEntryAnimation:!1},scenesMap[p]=f,F.type==="popup"||setPageScenes(M=>[...M,F]),scenesOperateInputsTodo[p]){const{parentScope:M,todo:V}=scenesOperateInputsTodo[p];f.parentScope=M,V.forEach(({value:lt,pinId:ot,parentScope:Z})=>{f.todo=f.todo.concat({type:"inputs",todo:{pinId:ot,value:lt}})})}}C?Object.entries(scenesMap).forEach(([F,M])=>{F===p?(C==="blank"?M.useEntryAnimation=!0:M.useEntryAnimation=!1,M.show=!0,M.type==="popup"?this.setPopupIds([...this.popupIds,p]):setCount(V=>V+1)):(M.show=!1,M.type==="popup"?this.setPopupIds(this.popupIds.filter(V=>V!==M.json.id)):setCount(V=>V+1))}):f.show||(C==="blank"?f.useEntryAnimation=!0:f.useEntryAnimation=!1,f.show=!0,f.type==="popup"?this.setPopupIds([...this.popupIds,p]):setCount(F=>F+1))}},(c=t.env)==null?void 0:c.canvas)},disableAutoRun:!0,ref:t.ref(p=>{r._refs=p;const{inputs:b,outputs:C}=p;u.outputs.forEach(f=>{C(f.id,g=>{var F;(F=r.parentScope)==null||F.outputs[f.id](g)})})}),_env:{loadCSSLazy(){},currentScenes:{close(){}}},scenesOperate:{open({todo:p,frameId:b,parentScope:C}){const f=n[b];f!=null&&f._refs&&(f.parentScope=C,f._refs.inputs[p.pinId](p.value,void 0,!1),f._refs.run())},inputs({frameId:p,parentScope:b,value:C,pinId:f}){const g=scenesMap[p];g?(g.parentScope=b,g._refs?g._refs.inputs[f](C):g.todo=g.todo.concat({type:"inputs",todo:{pinId:f,value:C}})):scenesOperateInputsTodo[p]?scenesOperateInputsTodo[p].todo.push({frameId:p,parentScope:b,value:C,pinId:f}):scenesOperateInputsTodo[p]={parentScope:b,todo:[{value:C,pinId:f}]}},_notifyBindings(p,b){const{bindingsTo:C}=b.model;if(C)for(let f in C)for(let g in scenesMap){const F=scenesMap[g];if(F.json.coms[f])if(F._refs)this._notifyBindings(F._refs,f,C[f],p);else{const V=C[f];F.todo=F.todo.concat({type:"globalVar",todo:{comId:f,bindings:V,value:p}})}}},getGlobalComProps(p){return scenesMap[o.scenes[0].id]._refs.get(p)},exeGlobalCom({com:p,value:b,pinId:C}){this.globalVarMap[p.id]=b,Object.keys(scenesMap).forEach(f=>{const g=scenesMap[f];if(g.show&&g._refs){const F=g._refs.get(p.id);F&&F.outputs[C](b,!0,null,!0)}})}}};let w=l.comsReg,m=l.consReg,O=l.pinRels;Object.keys(w).forEach(p=>{w[p].global=!0}),Object.assign(u.coms,w),Object.assign(u.cons,m),Object.assign(u.pinRels,O),s.push({key:x,component:Main,json:{...u,rtType:"js"},options:j})})}this.fxFramesMap=n,this.fxFramesJsx=s},computed:{scenes(){const{pageScenes:o,scenesMap:t}=this;if(!o.length)return[];const{json:e}=this.$props,{global:n}=e;let s={},l={},i={};return n&&(s=n.comsReg,l=n.consReg,i=n.pinRels,Object.keys(s).forEach(u=>{s[u].global=!0})),o.map((u,x)=>{const{id:r}=u;Object.assign(u.coms,s),Object.assign(u.cons,l),Object.assign(u.pinRels,i);const j=t[r];return{show:j.show,key:r,json:{...u,scenesMap:t},opts:this.options(r),className:j.useEntryAnimation?$style.main:"",style:j.type==="popup"?{position:"absolute",top:0,left:0,backgroundColor:"#ffffff00"}:{}}})},popups(){const{popupIds:o,scenesMap:t}=this;if(!o.length)return[];const{json:e}=this.$props,{global:n}=e;let s={},l={},i={};return n&&(s=n.comsReg,l=n.consReg,i=n.pinRels,Object.keys(s).forEach(u=>{s[u].global=!0})),o.map(u=>{const r=t[u].json,{id:j}=r;return Object.assign(r.coms,s),Object.assign(r.cons,l),Object.assign(r.pinRels,i),{key:r.id,json:{...r,scenesMap:t},opts:this.options(j),style:{position:"absolute",top:0,left:0,backgroundColor:"#ffffff00"}}})}},methods:{setCount(o){this.count=o},setPopupIds(o){this.popupIds=o},setPageScenes(o){this.pageScenes=o},options(o){var x;const{opts:t}=this.$props,{scenesMap:e,themes:n,permissions:s}=this,l=this,i=e[o],u=t.env.hasPermission;return{...t,env:{...t.env,themes:n,permissions:s,hasPermission:typeof u=="function"?r=>{if(typeof r=="string"){const j=s.find(w=>w.id===r);return u({permission:j})}return u(r)}:null,canvas:Object.assign({id:o,type:(window==null?void 0:window.document.body.clientWidth)<=414?"mobile":"pc",open:async(r,j,w)=>{var O;let m=e[r];if(!m){if(typeof t.scenesLoader!="function"){console.error(`缺少场景信息: ${r}`);return}const c=await t.scenesLoader({id:r});if(m={disableAutoRun:!1,json:c,show:!1,parentScope:null,todo:[],type:((O=c.slot)==null?void 0:O.showType)||c.type,useEntryAnimation:!1},e[r]=m,c.type==="popup"||setPageScenes(p=>[...p,c]),scenesOperateInputsTodo[r]){const{parentScope:p,todo:b}=scenesOperateInputsTodo[r];m.parentScope=p,b.forEach(({value:C,pinId:f,parentScope:g})=>{m.todo=m.todo.concat({type:"inputs",todo:{pinId:f,value:C}})})}}w?Object.entries(e).forEach(([c,p])=>{c===r?(w==="blank"?p.useEntryAnimation=!0:p.useEntryAnimation=!1,p.show=!0,p.type==="popup"?l.setPopupIds([...l.popupIds,r]):setCount(b=>b+1)):(p.show=!1,p.type==="popup"?l.setPopupIds(l.popupIds.filter(b=>b!==p.json.id)):setCount(b=>b+1))}):m.show||(w==="blank"?m.useEntryAnimation=!0:m.useEntryAnimation=!1,m.show=!0,m.type==="popup"?l.setPopupIds([...l.popupIds,r]):setCount(c=>c+1))}},(x=t.env)==null?void 0:x.canvas)},get disableAutoRun(){return i.disableAutoRun},ref:t.ref(r=>{i._refs=r;const j=i.todo,{inputs:w,outputs:m}=r,O=i.disableAutoRun;i.json.outputs.forEach(c=>{m(c.id,p=>{var b;i.show=!1,i.todo=[],i._refs=null,(b=i.parentScope)==null||b.outputs[c.id](p),i.parentScope=null,i.type==="popup"?l.setPopupIds(l.popupIds.filter(C=>C!==i.json.id)):setCount(C=>C+1)})}),j.length?(j.forEach(({type:c,todo:p})=>{if(c==="inputs")Promise.resolve().then(()=>{w[p.pinId](p.value,o)});else if(c==="globalVar"){const{comId:b,value:C,bindings:f}=p;l._notifyBindings(r,b,f,C)}}),i.todo=[]):O||(i.disableAutoRun=!0,Promise.resolve().then(()=>{var c,p;(p=(c=i.json.inputs)==null?void 0:c.forEach)==null||p.call(c,b=>{const{id:C,mockData:f}=b;let g;if(t.debug&&typeof f<"u")try{g=JSON.parse(decodeURIComponent(f))}catch{g=f}w[C](g)})})),O&&Promise.resolve().then(()=>{r.run()}),Object.entries(l.globalVarMap).forEach(([c,p])=>{const b=i._refs.get(c);b&&b.outputs.changed(p,!0,null,!0)})}),_env:{loadCSSLazy(){},currentScenes:{close(){i.show=!1,i.todo=[],i._refs=null,i.type==="popup"?(console.log(l,"that"),l.setPopupIds(l.popupIds.filter(r=>r!==i.json.id))):setCount(r=>r+1)}}},scenesOperate:{open({todo:r,frameId:j,parentScope:w}){const m=e[j];if(m)m.show||(m.show=!0,m.todo=m.todo.concat({type:"inputs",todo:r}),m.parentScope=w,m.type==="popup"?l.setPopupIds([...l.popupIds,j]):setCount(O=>O+1));else{const O=fxFramesMap[j];O!=null&&O._refs&&(O.parentScope=w,O._refs.inputs[r.pinId](r.value,void 0,!1),O._refs.run())}},inputs({frameId:r,parentScope:j,value:w,pinId:m}){const O=e[r];O?(O.parentScope=j,O._refs?O._refs.inputs[m](w):O.todo=O.todo.concat({type:"inputs",todo:{pinId:m,value:w}})):scenesOperateInputsTodo[r]?scenesOperateInputsTodo[r].todo.push({frameId:r,parentScope:j,value:w,pinId:m}):scenesOperateInputsTodo[r]={parentScope:j,todo:[{value:w,pinId:m}]}},_notifyBindings(r,j){const{bindingsTo:w}=j.model;if(w)for(let m in w)for(let O in e){const c=e[O];if(c.json.coms[m])if(c._refs)this._notifyBindings(c._refs,m,w[m],r);else{const b=w[m];c.todo=c.todo.concat({type:"globalVar",todo:{comId:m,bindings:b,value:r}})}}},getGlobalComProps(r){return e[json.scenes[0].id]._refs.get(r)},exeGlobalCom({com:r,value:j,pinId:w}){l.globalVarMap[r.id]=j,Object.keys(e).forEach(m=>{const O=e[m];if(O.show&&O._refs){const c=O._refs.get(r.id);c&&c.outputs[w](j,!0,null,!0)}})}}}},_notifyBindings(o,t,e,n){const s=o.get(t);s&&Array.isArray(e)&&e.forEach(l=>{let i=s;const u=l.split(".");u.forEach((x,r)=>{r!==u.length-1?i=i[x]:i[x]=n})})}}};var _sfc_render$2=function o(){var t=this,e=t._self._c;return e("div",[t._l(t.fxFramesJsx,function(n){return e(n.component,{key:n.key,tag:"component",attrs:{json:n.json,opts:n.options}})}),t._l(t.scenes,function(n){return n.show?e("Main",{key:n.key,attrs:{json:n.json,opts:n.opts,className:n.className,propsStyle:n.style}}):t._e()}),t._l(t.popups,function(n){return e("Main",{key:n.key,attrs:{json:n.json,opts:n.opts,className:n.className,propsStyle:n.style}})})],2)},_sfc_staticRenderFns$2=[];const __cssModules={$style:style0};function _sfc_injectStyles(o){for(var t in __cssModules)this[t]=__cssModules[t]}var __component__$2=normalizeComponent(_sfc_main$2,_sfc_render$2,_sfc_staticRenderFns$2,!1,_sfc_injectStyles,null,null,null);const MultiScene=__component__$2.exports;console.log("%c @mybricks/render-web-vue %c@0.0.1","color:#FFF;background:#fa6400","","");const _sfc_main$1={functional:!0,render(o,{props:t}){const n=Array.isArray(t.json.scenes)?MultiScene:Main;return o(n,{props:t},[])}},_sfc_render$1=null,_sfc_staticRenderFns$1=null;var __component__$1=normalizeComponent(_sfc_main$1,_sfc_render$1,_sfc_staticRenderFns$1,!1,null,null,null,null);const Render=__component__$1.exports,_sfc_main={components:{Render},props:{json:{type:Object},opts:{type:Object}}};var _sfc_render=function o(){var t=this,e=t._self._c;return e("Render",t._b({},"Render",this.$props,!1))},_sfc_staticRenderFns=[],__component__=normalizeComponent(_sfc_main,_sfc_render,_sfc_staticRenderFns,!1,null,null,null,null);const App=__component__.exports;function render(o,t){return Vue.extend({render:e=>e(App,{props:{json:o,opts:t}})})}window["mybricks-render-vue2"]=function o({json:t,opts:e},n){new Vue({render:s=>s(App,{props:{json:t,opts:e}},[])}).$mount(n)},exports.render=render,Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})});
